(* Content-type: application/mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 7.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       145,          7]
NotebookDataLength[     84968,       2471]
NotebookOptionsPosition[     81807,       2363]
NotebookOutlinePosition[     82178,       2379]
CellTagsIndexPosition[     82135,       2376]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.4731464536839905`*^9, 3.473146454370392*^9}, 
   3.473149239621684*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"Exit", "[", "]"}], ";"}]], "Input"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"na", "=", "1"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"s", "[", 
    RowBox[{"i_", ",", "j_"}], "]"}], "=", 
   RowBox[{"Piecewise", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{"0", ",", 
        RowBox[{"i", "<", "j"}]}], "}"}], "}"}], ",", 
     RowBox[{"\[Sigma]", "[", 
      RowBox[{"i", ",", "j"}], "]"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"r", "[", 
    RowBox[{"i_", ",", "j_"}], "]"}], "=", 
   RowBox[{"Piecewise", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{"1", ",", 
        RowBox[{"i", "\[Equal]", "j"}]}], "}"}], "}"}], ",", 
     RowBox[{"\[Rho]", "[", 
      RowBox[{"i", ",", "j"}], "]"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Repla", "=", 
   RowBox[{
    RowBox[{"Solve", "[", 
     RowBox[{
      RowBox[{"Flatten", "[", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Sum", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"s", "[", 
              RowBox[{"i", ",", "j"}], "]"}], 
             RowBox[{"s", "[", 
              RowBox[{"k", ",", "j"}], "]"}]}], ",", 
            RowBox[{"{", 
             RowBox[{"j", ",", "na"}], "}"}]}], "]"}], "\[Equal]", 
          RowBox[{"r", "[", 
           RowBox[{"k", ",", "i"}], "]"}]}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "na"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"k", ",", "i"}], "}"}]}], "]"}], "]"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"Flatten", "[", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{"s", "[", 
          RowBox[{"i", ",", "j"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "na"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"j", ",", "i"}], "}"}]}], "]"}], "]"}]}], "]"}], "[", 
    RowBox[{"[", 
     RowBox[{"2", "^", "na"}], "]"}], "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.4731435948833694`*^9, 3.473143653945073*^9}, {
   3.473143883015875*^9, 3.473143893046693*^9}, {3.4731439925748672`*^9, 
   3.473144142569131*^9}, {3.473144356071106*^9, 3.4731443666323247`*^9}, {
   3.4731446265609813`*^9, 3.4731446354061966`*^9}, {3.4731480492425933`*^9, 
   3.473148083687454*^9}, {3.4731481140919075`*^9, 3.473148123015123*^9}, {
   3.473148814769538*^9, 3.4731488265943584`*^9}, {3.473148868137232*^9, 
   3.473148880757654*^9}, {3.4731489190713215`*^9, 3.4731490286927137`*^9}, {
   3.473149074962395*^9, 3.473149260483323*^9}, {3.473149316081821*^9, 
   3.4731493282654424`*^9}, {3.473150434120185*^9, 3.4731504368501897`*^9}, 
   3.4731507234236927`*^9, 3.4731510118209996`*^9, 3.4731518505408726`*^9, 
   3.473151920194995*^9, {3.4732375661923723`*^9, 3.473237568088481*^9}, {
   3.4746926861180525`*^9, 3.474692686242853*^9}, {3.4746945170046687`*^9, 
   3.4746945175038695`*^9}, {3.474695409112836*^9, 3.4746954096744366`*^9}}],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"$Assumptions", "=", 
   RowBox[{
    RowBox[{
     RowBox[{"dt", "^", "2"}], "\[Equal]", "0"}], "&&", 
    RowBox[{"S", ">", "0"}], "&&", 
    RowBox[{"M", ">", "0"}], "&&", 
    RowBox[{"s", ">", "0"}], " ", "&&", " ", 
    RowBox[{"And", "@@", 
     RowBox[{"Join", "[", 
      RowBox[{
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"dW", "[", "i", "]"}], "^", "2"}], "\[Equal]", "dt"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "na"}], "}"}]}], "]"}], ",", 
       RowBox[{"Table", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"dW", "[", "i", "]"}], "dt"}], "\[Equal]", "0"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "na"}], "}"}]}], "]"}], ",", 
       RowBox[{"Flatten", "[", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"dW", "[", "i", "]"}], 
            RowBox[{"dW", "[", "j", "]"}]}], "\[Equal]", "0"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "na"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"j", ",", 
            RowBox[{"i", "-", "1"}]}], "}"}]}], "]"}], "]"}]}], "]"}]}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"dB", "[", "i_", "]"}], "=", 
   RowBox[{"Sum", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"s", "[", 
       RowBox[{"i", ",", "j"}], "]"}], " ", 
      RowBox[{"dW", "[", "j", "]"}]}], ",", 
     RowBox[{"{", 
      RowBox[{"j", ",", "na"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"dS", "[", "i_", "]"}], "=", 
   RowBox[{
    RowBox[{"r", " ", 
     RowBox[{"S", "[", "i", "]"}], " ", "dt"}], "+", 
    RowBox[{
     RowBox[{"\[Sigma]", "[", "i", "]"}], 
     RowBox[{"S", "[", "i", "]"}], " ", 
     RowBox[{"dB", "[", "i", "]"}]}]}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"dP", "=", 
   RowBox[{
    RowBox[{"P", " ", 
     RowBox[{"Sum", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"q", "[", "i", "]"}], " ", "/", 
         RowBox[{"S", "[", "i", "]"}]}], " ", 
        RowBox[{"dS", "[", "i", "]"}]}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "na"}], "}"}]}], "]"}]}], "+", 
    RowBox[{"r", " ", "P", 
     RowBox[{"(", 
      RowBox[{"1", "-", 
       RowBox[{"Sum", "[", 
        RowBox[{
         RowBox[{"q", "[", "i", "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "na"}], "}"}]}], "]"}]}], ")"}], " ", "dt"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{" ", 
  RowBox[{
   RowBox[{"dDX", "=", 
    RowBox[{"Sum", "[", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"\[CapitalDelta]", "[", "i", "]"}], " ", 
        RowBox[{"dS", "[", "i", "]"}]}], "  ", "-", 
       RowBox[{"r", " ", 
        RowBox[{"\[CapitalDelta]", "[", "i", "]"}], " ", 
        RowBox[{"S", "[", "i", "]"}], "dt"}]}], ",", 
      RowBox[{"{", 
       RowBox[{"i", ",", "na"}], "}"}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"dDV", "=", 
   RowBox[{"Simplify", "[", 
    RowBox[{"Expand", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Normal", "[", 
          RowBox[{
           RowBox[{"Series", "[", 
            RowBox[{
             RowBox[{"V", "[", 
              RowBox[{"a", ",", "b", ",", "c", ",", "d"}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"a", ",", "t", ",", "1"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"b", ",", "P", ",", "2"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"c", ",", 
               RowBox[{"S", "[", "1", "]"}], ",", "2"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"d", ",", 
               RowBox[{"S", "[", "2", "]"}], ",", "2"}], "}"}]}], "]"}], "-", 
           RowBox[{"V", "[", 
            RowBox[{"t", ",", "P", ",", 
             RowBox[{"S", "[", "1", "]"}], ",", 
             RowBox[{"S", "[", "2", "]"}]}], "]"}], "\[IndentingNewLine]", 
           "-", 
           RowBox[{"r", " ", 
            RowBox[{"V", "[", 
             RowBox[{"t", ",", "P", ",", 
              RowBox[{"S", "[", "1", "]"}], ",", 
              RowBox[{"S", "[", "2", "]"}]}], "]"}], "dt"}]}], "]"}], "/.", 
         RowBox[{"a", "\[Rule]", 
          RowBox[{"t", "+", "dt"}]}]}], "/.", 
        RowBox[{"b", "\[Rule]", 
         RowBox[{"P", "+", "dP"}]}]}], "/.", 
       RowBox[{"c", "\[Rule]", 
        RowBox[{
         RowBox[{"S", "[", "1", "]"}], "+", 
         RowBox[{"dS", "[", "1", "]"}]}]}]}], "/.", 
      RowBox[{"d", "\[Rule]", 
       RowBox[{
        RowBox[{"S", "[", "2", "]"}], "+", 
        RowBox[{"dS", "[", "2", "]"}]}]}]}], "\[IndentingNewLine]", "]"}], 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"dDV", "=", 
    RowBox[{"Simplify", "[", 
     RowBox[{"Expand", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Normal", "[", 
          RowBox[{
           RowBox[{"Series", "[", 
            RowBox[{
             RowBox[{"V", "[", 
              RowBox[{"a", ",", "b", ",", 
               RowBox[{"c", "/", "b"}]}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"a", ",", "t", ",", "1"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"b", ",", "P", ",", "2"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"c", ",", 
               RowBox[{"S", "[", "1", "]"}], ",", "2"}], "}"}]}], "]"}], "-", 
           RowBox[{"V", "[", 
            RowBox[{"t", ",", "P", ",", 
             RowBox[{"S", "[", "1", "]"}]}], "]"}], "\[IndentingNewLine]", 
           "-", 
           RowBox[{"r", " ", 
            RowBox[{"V", "[", 
             RowBox[{"t", ",", "P", ",", 
              RowBox[{"S", "[", "1", "]"}]}], "]"}], "dt"}]}], "]"}], "/.", 
         RowBox[{"a", "\[Rule]", 
          RowBox[{"t", "+", "dt"}]}]}], "/.", 
        RowBox[{"b", "\[Rule]", 
         RowBox[{"P", "+", "dP"}]}]}], "/.", 
       RowBox[{"c", "\[Rule]", 
        RowBox[{
         RowBox[{"S", "[", "1", "]"}], "+", 
         RowBox[{"dS", "[", "1", "]"}]}]}]}], "\[IndentingNewLine]", "]"}], 
     "]"}]}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Eqn", "=", 
   RowBox[{"Simplify", "[", 
    RowBox[{
     RowBox[{"0", "==", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"dDX", "-", "dDV"}], "/.", 
          RowBox[{"dt", "\[Rule]", "0"}]}], "/.", 
         RowBox[{
          RowBox[{"dW", "[", "i", "]"}], "\[Rule]", "1"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "na"}], "}"}]}], "]"}]}], "/.", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"dW", "[", "i", "]"}], "\[Rule]", "0"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "na"}], "}"}]}], "]"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"HR", "=", 
  RowBox[{
   RowBox[{
    RowBox[{"#", "[", 
     RowBox[{"[", "2", "]"}], "]"}], "&"}], "/@", 
   RowBox[{
    RowBox[{"Solve", "[", 
     RowBox[{"Eqn", ",", 
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"\[CapitalDelta]", "[", "i", "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "na"}], "}"}]}], "]"}]}], "]"}], "[", 
    RowBox[{"[", "1", "]"}], "]"}]}]}], "\[IndentingNewLine]", 
 RowBox[{"FKE", "=", 
  RowBox[{"Expand", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"dDV", "-", "dDX"}], "/.", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"dW", "[", "i", "]"}], "\[Rule]", "0"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "na"}], "}"}]}], "]"}]}], "/.", 
    RowBox[{"dt", "\[Rule]", "1"}]}], "]"}]}]}], "Input",
 CellChangeTimes->{{3.4731446389786034`*^9, 3.473144782358455*^9}, {
   3.4731448994210606`*^9, 3.473144931089116*^9}, {3.473145004175245*^9, 
   3.4731450428321123`*^9}, {3.473145540535387*^9, 3.473145555386613*^9}, {
   3.4731456716068172`*^9, 3.473145825345087*^9}, {3.4731458993048167`*^9, 
   3.4731459012548203`*^9}, {3.4731459429068937`*^9, 3.473145984731567*^9}, {
   3.4731463573538218`*^9, 3.4731464222187357`*^9}, {3.473146516614501*^9, 
   3.473146534632533*^9}, {3.4731466481851325`*^9, 3.4731466483723326`*^9}, 
   3.4731466937684126`*^9, {3.473146793889388*^9, 3.4731467989749975`*^9}, {
   3.4731474485601377`*^9, 3.4731474498081408`*^9}, {3.473147998604904*^9, 
   3.4731480010541086`*^9}, {3.473148037807773*^9, 3.473148039414576*^9}, {
   3.4731481365091467`*^9, 3.473148138037949*^9}, {3.473148187380836*^9, 
   3.473148243465335*^9}, {3.473148277894595*^9, 3.473148304523842*^9}, {
   3.473148341511507*^9, 3.4731483432899103`*^9}, {3.473148623965603*^9, 
   3.4731486527788534`*^9}, {3.4731492761769505`*^9, 
   3.4731492884229727`*^9}, {3.473149470381692*^9, 3.473149498836142*^9}, {
   3.473149648081604*^9, 3.473149664570833*^9}, {3.473149716690525*^9, 
   3.4731497236793365`*^9}, {3.4731497671878133`*^9, 3.473149776142229*^9}, {
   3.473149808527886*^9, 3.4731498283555207`*^9}, {3.4731499260428925`*^9, 
   3.473149929584099*^9}, {3.4731499663689632`*^9, 3.4731499837473936`*^9}, 
   3.4731501578124995`*^9, 3.4731501997921734`*^9, {3.473150244252251*^9, 
   3.4731502488386593`*^9}, {3.473150356369648*^9, 3.473150376649684*^9}, {
   3.4731505269247475`*^9, 3.473150560574007*^9}, {3.4746945254598837`*^9, 
   3.4746945684223595`*^9}, {3.4746954245880632`*^9, 
   3.4746954406404915`*^9}, {3.4746981261728077`*^9, 3.474698173902892*^9}, {
   3.4746982066941495`*^9, 3.4746982350237994`*^9}, {3.4747012844254217`*^9, 
   3.474701284737422*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   FractionBox["1", 
    RowBox[{"P", " ", 
     RowBox[{"S", "[", "1", "]"}], " ", 
     RowBox[{"\[Sigma]", "[", "1", "]"}], " ", 
     RowBox[{"\[Sigma]", "[", 
      RowBox[{"1", ",", "1"}], "]"}]}]], 
   RowBox[{"(", 
    RowBox[{
     RowBox[{
      RowBox[{"-", "P"}], " ", 
      RowBox[{"V", "[", 
       RowBox[{"t", ",", "P", ",", 
        RowBox[{"S", "[", "1", "]"}]}], "]"}]}], "+", 
     RowBox[{"P", " ", 
      RowBox[{"V", "[", 
       RowBox[{"t", ",", "P", ",", 
        FractionBox[
         RowBox[{"S", "[", "1", "]"}], "P"]}], "]"}]}], "+", 
     RowBox[{
      RowBox[{"S", "[", "1", "]"}], " ", 
      RowBox[{"\[Sigma]", "[", "1", "]"}], " ", 
      RowBox[{"\[Sigma]", "[", 
       RowBox[{"1", ",", "1"}], "]"}], " ", 
      RowBox[{
       SuperscriptBox["V", 
        TagBox[
         RowBox[{"(", 
          RowBox[{"0", ",", "0", ",", "1"}], ")"}],
         Derivative],
        MultilineFunction->None], "[", 
       RowBox[{"t", ",", "P", ",", 
        FractionBox[
         RowBox[{"S", "[", "1", "]"}], "P"]}], "]"}]}], "-", 
     RowBox[{
      RowBox[{"q", "[", "1", "]"}], " ", 
      RowBox[{"S", "[", "1", "]"}], " ", 
      RowBox[{"\[Sigma]", "[", "1", "]"}], " ", 
      RowBox[{"\[Sigma]", "[", 
       RowBox[{"1", ",", "1"}], "]"}], " ", 
      RowBox[{
       SuperscriptBox["V", 
        TagBox[
         RowBox[{"(", 
          RowBox[{"0", ",", "0", ",", "1"}], ")"}],
         Derivative],
        MultilineFunction->None], "[", 
       RowBox[{"t", ",", "P", ",", 
        FractionBox[
         RowBox[{"S", "[", "1", "]"}], "P"]}], "]"}]}], "+", 
     RowBox[{
      SuperscriptBox["P", "2"], " ", 
      RowBox[{"q", "[", "1", "]"}], " ", 
      RowBox[{"\[Sigma]", "[", "1", "]"}], " ", 
      RowBox[{"\[Sigma]", "[", 
       RowBox[{"1", ",", "1"}], "]"}], " ", 
      RowBox[{
       SuperscriptBox["V", 
        TagBox[
         RowBox[{"(", 
          RowBox[{"0", ",", "1", ",", "0"}], ")"}],
         Derivative],
        MultilineFunction->None], "[", 
       RowBox[{"t", ",", "P", ",", 
        FractionBox[
         RowBox[{"S", "[", "1", "]"}], "P"]}], "]"}]}]}], ")"}]}], 
  "}"}]], "Output",
 CellChangeTimes->{{3.473150534943162*^9, 3.4731505614008083`*^9}, 
   3.473150724422095*^9, 3.473151851898075*^9, 3.4731519222073984`*^9, 
   3.473237570061594*^9, 3.4746926906732607`*^9, 3.4746945782347765`*^9, {
   3.474695412092441*^9, 3.474695441701293*^9}, 3.4746981751664944`*^9, 
   3.4746982378474045`*^9, 3.474701286188225*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"-", 
   RowBox[{"V", "[", 
    RowBox[{"t", ",", "P", ",", 
     RowBox[{"S", "[", "1", "]"}]}], "]"}]}], "-", 
  RowBox[{"r", " ", 
   RowBox[{"V", "[", 
    RowBox[{"t", ",", "P", ",", 
     RowBox[{"S", "[", "1", "]"}]}], "]"}]}], "+", 
  RowBox[{"V", "[", 
   RowBox[{"t", ",", "P", ",", 
    FractionBox[
     RowBox[{"S", "[", "1", "]"}], "P"]}], "]"}], "-", 
  FractionBox[
   RowBox[{
    RowBox[{"q", "[", "1", "]"}], " ", 
    RowBox[{"S", "[", "1", "]"}], " ", 
    SuperscriptBox[
     RowBox[{"\[Sigma]", "[", "1", "]"}], "2"], " ", 
    SuperscriptBox[
     RowBox[{"\[Sigma]", "[", 
      RowBox[{"1", ",", "1"}], "]"}], "2"], " ", 
    RowBox[{
     SuperscriptBox["V", 
      TagBox[
       RowBox[{"(", 
        RowBox[{"0", ",", "0", ",", "1"}], ")"}],
       Derivative],
      MultilineFunction->None], "[", 
     RowBox[{"t", ",", "P", ",", 
      FractionBox[
       RowBox[{"S", "[", "1", "]"}], "P"]}], "]"}]}], "P"], "+", 
  FractionBox[
   RowBox[{
    SuperscriptBox[
     RowBox[{"q", "[", "1", "]"}], "2"], " ", 
    RowBox[{"S", "[", "1", "]"}], " ", 
    SuperscriptBox[
     RowBox[{"\[Sigma]", "[", "1", "]"}], "2"], " ", 
    SuperscriptBox[
     RowBox[{"\[Sigma]", "[", 
      RowBox[{"1", ",", "1"}], "]"}], "2"], " ", 
    RowBox[{
     SuperscriptBox["V", 
      TagBox[
       RowBox[{"(", 
        RowBox[{"0", ",", "0", ",", "1"}], ")"}],
       Derivative],
      MultilineFunction->None], "[", 
     RowBox[{"t", ",", "P", ",", 
      FractionBox[
       RowBox[{"S", "[", "1", "]"}], "P"]}], "]"}]}], "P"], "+", 
  FractionBox[
   RowBox[{
    SuperscriptBox[
     RowBox[{"S", "[", "1", "]"}], "2"], " ", 
    SuperscriptBox[
     RowBox[{"\[Sigma]", "[", "1", "]"}], "2"], " ", 
    SuperscriptBox[
     RowBox[{"\[Sigma]", "[", 
      RowBox[{"1", ",", "1"}], "]"}], "2"], " ", 
    RowBox[{
     SuperscriptBox["V", 
      TagBox[
       RowBox[{"(", 
        RowBox[{"0", ",", "0", ",", "2"}], ")"}],
       Derivative],
      MultilineFunction->None], "[", 
     RowBox[{"t", ",", "P", ",", 
      FractionBox[
       RowBox[{"S", "[", "1", "]"}], "P"]}], "]"}]}], 
   RowBox[{"2", " ", 
    SuperscriptBox["P", "2"]}]], "-", 
  FractionBox[
   RowBox[{
    RowBox[{"q", "[", "1", "]"}], " ", 
    SuperscriptBox[
     RowBox[{"S", "[", "1", "]"}], "2"], " ", 
    SuperscriptBox[
     RowBox[{"\[Sigma]", "[", "1", "]"}], "2"], " ", 
    SuperscriptBox[
     RowBox[{"\[Sigma]", "[", 
      RowBox[{"1", ",", "1"}], "]"}], "2"], " ", 
    RowBox[{
     SuperscriptBox["V", 
      TagBox[
       RowBox[{"(", 
        RowBox[{"0", ",", "0", ",", "2"}], ")"}],
       Derivative],
      MultilineFunction->None], "[", 
     RowBox[{"t", ",", "P", ",", 
      FractionBox[
       RowBox[{"S", "[", "1", "]"}], "P"]}], "]"}]}], 
   SuperscriptBox["P", "2"]], "+", 
  FractionBox[
   RowBox[{
    SuperscriptBox[
     RowBox[{"q", "[", "1", "]"}], "2"], " ", 
    SuperscriptBox[
     RowBox[{"S", "[", "1", "]"}], "2"], " ", 
    SuperscriptBox[
     RowBox[{"\[Sigma]", "[", "1", "]"}], "2"], " ", 
    SuperscriptBox[
     RowBox[{"\[Sigma]", "[", 
      RowBox[{"1", ",", "1"}], "]"}], "2"], " ", 
    RowBox[{
     SuperscriptBox["V", 
      TagBox[
       RowBox[{"(", 
        RowBox[{"0", ",", "0", ",", "2"}], ")"}],
       Derivative],
      MultilineFunction->None], "[", 
     RowBox[{"t", ",", "P", ",", 
      FractionBox[
       RowBox[{"S", "[", "1", "]"}], "P"]}], "]"}]}], 
   RowBox[{"2", " ", 
    SuperscriptBox["P", "2"]}]], "+", 
  RowBox[{"P", " ", "r", " ", 
   RowBox[{
    SuperscriptBox["V", 
     TagBox[
      RowBox[{"(", 
       RowBox[{"0", ",", "1", ",", "0"}], ")"}],
      Derivative],
     MultilineFunction->None], "[", 
    RowBox[{"t", ",", "P", ",", 
     FractionBox[
      RowBox[{"S", "[", "1", "]"}], "P"]}], "]"}]}], "+", 
  RowBox[{
   RowBox[{"q", "[", "1", "]"}], " ", 
   RowBox[{"S", "[", "1", "]"}], " ", 
   SuperscriptBox[
    RowBox[{"\[Sigma]", "[", "1", "]"}], "2"], " ", 
   SuperscriptBox[
    RowBox[{"\[Sigma]", "[", 
     RowBox[{"1", ",", "1"}], "]"}], "2"], " ", 
   RowBox[{
    SuperscriptBox["V", 
     TagBox[
      RowBox[{"(", 
       RowBox[{"0", ",", "1", ",", "1"}], ")"}],
      Derivative],
     MultilineFunction->None], "[", 
    RowBox[{"t", ",", "P", ",", 
     FractionBox[
      RowBox[{"S", "[", "1", "]"}], "P"]}], "]"}]}], "-", 
  RowBox[{
   SuperscriptBox[
    RowBox[{"q", "[", "1", "]"}], "2"], " ", 
   RowBox[{"S", "[", "1", "]"}], " ", 
   SuperscriptBox[
    RowBox[{"\[Sigma]", "[", "1", "]"}], "2"], " ", 
   SuperscriptBox[
    RowBox[{"\[Sigma]", "[", 
     RowBox[{"1", ",", "1"}], "]"}], "2"], " ", 
   RowBox[{
    SuperscriptBox["V", 
     TagBox[
      RowBox[{"(", 
       RowBox[{"0", ",", "1", ",", "1"}], ")"}],
      Derivative],
     MultilineFunction->None], "[", 
    RowBox[{"t", ",", "P", ",", 
     FractionBox[
      RowBox[{"S", "[", "1", "]"}], "P"]}], "]"}]}], "+", 
  RowBox[{
   FractionBox["1", "2"], " ", 
   SuperscriptBox["P", "2"], " ", 
   SuperscriptBox[
    RowBox[{"q", "[", "1", "]"}], "2"], " ", 
   SuperscriptBox[
    RowBox[{"\[Sigma]", "[", "1", "]"}], "2"], " ", 
   SuperscriptBox[
    RowBox[{"\[Sigma]", "[", 
     RowBox[{"1", ",", "1"}], "]"}], "2"], " ", 
   RowBox[{
    SuperscriptBox["V", 
     TagBox[
      RowBox[{"(", 
       RowBox[{"0", ",", "2", ",", "0"}], ")"}],
      Derivative],
     MultilineFunction->None], "[", 
    RowBox[{"t", ",", "P", ",", 
     FractionBox[
      RowBox[{"S", "[", "1", "]"}], "P"]}], "]"}]}], "+", 
  RowBox[{
   SuperscriptBox["V", 
    TagBox[
     RowBox[{"(", 
      RowBox[{"1", ",", "0", ",", "0"}], ")"}],
     Derivative],
    MultilineFunction->None], "[", 
   RowBox[{"t", ",", "P", ",", 
    FractionBox[
     RowBox[{"S", "[", "1", "]"}], "P"]}], "]"}]}]], "Output",
 CellChangeTimes->{{3.473150534943162*^9, 3.4731505614008083`*^9}, 
   3.473150724422095*^9, 3.473151851898075*^9, 3.4731519222073984`*^9, 
   3.473237570061594*^9, 3.4746926906732607`*^9, 3.4746945782347765`*^9, {
   3.474695412092441*^9, 3.474695441701293*^9}, 3.4746981751664944`*^9, 
   3.4746982378474045`*^9, 3.474701286203825*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"MatrixForm", "[", "Repla", "]"}]], "Input",
 CellChangeTimes->{{3.4746927560101757`*^9, 3.474692787960032*^9}}],

Cell[BoxData[
 TagBox[
  RowBox[{"(", "\[NoBreak]", 
   TagBox[GridBox[{
      {
       RowBox[{
        RowBox[{"\[Sigma]", "[", 
         RowBox[{"3", ",", "3"}], "]"}], "\[Rule]", 
        SqrtBox[
         RowBox[{"1", "-", 
          SuperscriptBox[
           RowBox[{"\[Rho]", "[", 
            RowBox[{"1", ",", "3"}], "]"}], "2"], "-", 
          FractionBox[
           RowBox[{
            RowBox[{
             RowBox[{"-", 
              SuperscriptBox[
               RowBox[{"\[Rho]", "[", 
                RowBox[{"1", ",", "2"}], "]"}], "2"]}], " ", 
             SuperscriptBox[
              RowBox[{"\[Rho]", "[", 
               RowBox[{"1", ",", "3"}], "]"}], "2"]}], "+", 
            RowBox[{"2", " ", 
             RowBox[{"\[Rho]", "[", 
              RowBox[{"1", ",", "2"}], "]"}], " ", 
             RowBox[{"\[Rho]", "[", 
              RowBox[{"1", ",", "3"}], "]"}], " ", 
             RowBox[{"\[Rho]", "[", 
              RowBox[{"2", ",", "3"}], "]"}]}], "-", 
            SuperscriptBox[
             RowBox[{"\[Rho]", "[", 
              RowBox[{"2", ",", "3"}], "]"}], "2"]}], 
           RowBox[{
            RowBox[{"-", "1"}], "+", 
            SuperscriptBox[
             RowBox[{"\[Rho]", "[", 
              RowBox[{"1", ",", "2"}], "]"}], "2"]}]]}]]}]},
      {
       RowBox[{
        RowBox[{"\[Sigma]", "[", 
         RowBox[{"1", ",", "1"}], "]"}], "\[Rule]", "1"}]},
      {
       RowBox[{
        RowBox[{"\[Sigma]", "[", 
         RowBox[{"2", ",", "2"}], "]"}], "\[Rule]", 
        FractionBox[
         RowBox[{
          SqrtBox[
           RowBox[{
            RowBox[{"-", "1"}], "+", 
            SuperscriptBox[
             RowBox[{"\[Rho]", "[", 
              RowBox[{"1", ",", "2"}], "]"}], "2"]}]], " ", 
          SqrtBox[
           RowBox[{
            RowBox[{
             RowBox[{"-", 
              SuperscriptBox[
               RowBox[{"\[Rho]", "[", 
                RowBox[{"1", ",", "2"}], "]"}], "2"]}], " ", 
             SuperscriptBox[
              RowBox[{"\[Rho]", "[", 
               RowBox[{"1", ",", "3"}], "]"}], "2"]}], "+", 
            RowBox[{"2", " ", 
             RowBox[{"\[Rho]", "[", 
              RowBox[{"1", ",", "2"}], "]"}], " ", 
             RowBox[{"\[Rho]", "[", 
              RowBox[{"1", ",", "3"}], "]"}], " ", 
             RowBox[{"\[Rho]", "[", 
              RowBox[{"2", ",", "3"}], "]"}]}], "-", 
            SuperscriptBox[
             RowBox[{"\[Rho]", "[", 
              RowBox[{"2", ",", "3"}], "]"}], "2"]}]]}], 
         RowBox[{
          RowBox[{
           RowBox[{"\[Rho]", "[", 
            RowBox[{"1", ",", "2"}], "]"}], " ", 
           RowBox[{"\[Rho]", "[", 
            RowBox[{"1", ",", "3"}], "]"}]}], "-", 
          RowBox[{"\[Rho]", "[", 
           RowBox[{"2", ",", "3"}], "]"}]}]]}]},
      {
       RowBox[{
        RowBox[{"\[Sigma]", "[", 
         RowBox[{"3", ",", "2"}], "]"}], "\[Rule]", 
        FractionBox[
         SqrtBox[
          RowBox[{
           RowBox[{
            RowBox[{"-", 
             SuperscriptBox[
              RowBox[{"\[Rho]", "[", 
               RowBox[{"1", ",", "2"}], "]"}], "2"]}], " ", 
            SuperscriptBox[
             RowBox[{"\[Rho]", "[", 
              RowBox[{"1", ",", "3"}], "]"}], "2"]}], "+", 
           RowBox[{"2", " ", 
            RowBox[{"\[Rho]", "[", 
             RowBox[{"1", ",", "2"}], "]"}], " ", 
            RowBox[{"\[Rho]", "[", 
             RowBox[{"1", ",", "3"}], "]"}], " ", 
            RowBox[{"\[Rho]", "[", 
             RowBox[{"2", ",", "3"}], "]"}]}], "-", 
           SuperscriptBox[
            RowBox[{"\[Rho]", "[", 
             RowBox[{"2", ",", "3"}], "]"}], "2"]}]], 
         SqrtBox[
          RowBox[{
           RowBox[{"-", "1"}], "+", 
           SuperscriptBox[
            RowBox[{"\[Rho]", "[", 
             RowBox[{"1", ",", "2"}], "]"}], "2"]}]]]}]},
      {
       RowBox[{
        RowBox[{"\[Sigma]", "[", 
         RowBox[{"2", ",", "1"}], "]"}], "\[Rule]", 
        RowBox[{"\[Rho]", "[", 
         RowBox[{"1", ",", "2"}], "]"}]}]},
      {
       RowBox[{
        RowBox[{"\[Sigma]", "[", 
         RowBox[{"3", ",", "1"}], "]"}], "\[Rule]", 
        RowBox[{"\[Rho]", "[", 
         RowBox[{"1", ",", "3"}], "]"}]}]}
     },
     GridBoxAlignment->{
      "Columns" -> {{Center}}, "ColumnsIndexed" -> {}, "Rows" -> {{Baseline}},
        "RowsIndexed" -> {}},
     GridBoxSpacings->{"Columns" -> {
         Offset[0.27999999999999997`], {
          Offset[0.5599999999999999]}, 
         Offset[0.27999999999999997`]}, "ColumnsIndexed" -> {}, "Rows" -> {
         Offset[0.2], {
          Offset[0.4]}, 
         Offset[0.2]}, "RowsIndexed" -> {}}],
    Column], "\[NoBreak]", ")"}],
  Function[BoxForm`e$, 
   MatrixForm[BoxForm`e$]]]], "Output",
 CellChangeTimes->{3.4746927567901773`*^9, 3.4746927884904327`*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Simplify", "[", 
  RowBox[{"dDV", "/.", "Repla"}], "]"}]], "Input",
 CellChangeTimes->{{3.4746940903907194`*^9, 3.4746940986587343`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(", 
   RowBox[{
    RowBox[{"2", " ", 
     RowBox[{"dW", "[", "3", "]"}], " ", 
     RowBox[{"q", "[", "3", "]"}], " ", 
     SqrtBox[
      RowBox[{
       RowBox[{"-", "1"}], "+", 
       SuperscriptBox[
        RowBox[{"\[Rho]", "[", 
         RowBox[{"1", ",", "2"}], "]"}], "2"]}]], " ", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"\[Rho]", "[", 
         RowBox[{"1", ",", "2"}], "]"}], " ", 
        RowBox[{"\[Rho]", "[", 
         RowBox[{"1", ",", "3"}], "]"}]}], "-", 
       RowBox[{"\[Rho]", "[", 
        RowBox[{"2", ",", "3"}], "]"}]}], ")"}], " ", 
     SqrtBox[
      FractionBox[
       RowBox[{
        RowBox[{"-", "1"}], "+", 
        SuperscriptBox[
         RowBox[{"\[Rho]", "[", 
          RowBox[{"1", ",", "2"}], "]"}], "2"], "+", 
        SuperscriptBox[
         RowBox[{"\[Rho]", "[", 
          RowBox[{"1", ",", "3"}], "]"}], "2"], "-", 
        RowBox[{"2", " ", 
         RowBox[{"\[Rho]", "[", 
          RowBox[{"1", ",", "2"}], "]"}], " ", 
         RowBox[{"\[Rho]", "[", 
          RowBox[{"1", ",", "3"}], "]"}], " ", 
         RowBox[{"\[Rho]", "[", 
          RowBox[{"2", ",", "3"}], "]"}]}], "+", 
        SuperscriptBox[
         RowBox[{"\[Rho]", "[", 
          RowBox[{"2", ",", "3"}], "]"}], "2"]}], 
       RowBox[{
        RowBox[{"-", "1"}], "+", 
        SuperscriptBox[
         RowBox[{"\[Rho]", "[", 
          RowBox[{"1", ",", "2"}], "]"}], "2"]}]]], " ", 
     RowBox[{"\[Sigma]", "[", "3", "]"}], " ", 
     RowBox[{
      SuperscriptBox["V", 
       TagBox[
        RowBox[{"(", 
         RowBox[{"0", ",", "1"}], ")"}],
        Derivative],
       MultilineFunction->None], "[", 
      RowBox[{"t", ",", "P"}], "]"}]}], "+", 
    RowBox[{"2", " ", 
     RowBox[{"dW", "[", "1", "]"}], " ", 
     SqrtBox[
      RowBox[{
       RowBox[{"-", "1"}], "+", 
       SuperscriptBox[
        RowBox[{"\[Rho]", "[", 
         RowBox[{"1", ",", "2"}], "]"}], "2"]}]], " ", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"\[Rho]", "[", 
         RowBox[{"1", ",", "2"}], "]"}], " ", 
        RowBox[{"\[Rho]", "[", 
         RowBox[{"1", ",", "3"}], "]"}]}], "-", 
       RowBox[{"\[Rho]", "[", 
        RowBox[{"2", ",", "3"}], "]"}]}], ")"}], " ", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"q", "[", "1", "]"}], " ", 
        RowBox[{"\[Sigma]", "[", "1", "]"}]}], "+", 
       RowBox[{
        RowBox[{"q", "[", "2", "]"}], " ", 
        RowBox[{"\[Rho]", "[", 
         RowBox[{"1", ",", "2"}], "]"}], " ", 
        RowBox[{"\[Sigma]", "[", "2", "]"}]}], "+", 
       RowBox[{
        RowBox[{"q", "[", "3", "]"}], " ", 
        RowBox[{"\[Rho]", "[", 
         RowBox[{"1", ",", "3"}], "]"}], " ", 
        RowBox[{"\[Sigma]", "[", "3", "]"}]}]}], ")"}], " ", 
     RowBox[{
      SuperscriptBox["V", 
       TagBox[
        RowBox[{"(", 
         RowBox[{"0", ",", "1"}], ")"}],
        Derivative],
       MultilineFunction->None], "[", 
      RowBox[{"t", ",", "P"}], "]"}]}], "+", 
    RowBox[{"2", " ", 
     RowBox[{"dW", "[", "2", "]"}], " ", 
     SqrtBox[
      RowBox[{"-", 
       SuperscriptBox[
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"-", 
            RowBox[{"\[Rho]", "[", 
             RowBox[{"1", ",", "2"}], "]"}]}], " ", 
           RowBox[{"\[Rho]", "[", 
            RowBox[{"1", ",", "3"}], "]"}]}], "+", 
          RowBox[{"\[Rho]", "[", 
           RowBox[{"2", ",", "3"}], "]"}]}], ")"}], "2"]}]], " ", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"q", "[", "2", "]"}], " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"-", "1"}], "+", 
          SuperscriptBox[
           RowBox[{"\[Rho]", "[", 
            RowBox[{"1", ",", "2"}], "]"}], "2"]}], ")"}], " ", 
        RowBox[{"\[Sigma]", "[", "2", "]"}]}], "+", 
       RowBox[{
        RowBox[{"q", "[", "3", "]"}], " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"\[Rho]", "[", 
            RowBox[{"1", ",", "2"}], "]"}], " ", 
           RowBox[{"\[Rho]", "[", 
            RowBox[{"1", ",", "3"}], "]"}]}], "-", 
          RowBox[{"\[Rho]", "[", 
           RowBox[{"2", ",", "3"}], "]"}]}], ")"}], " ", 
        RowBox[{"\[Sigma]", "[", "3", "]"}]}]}], ")"}], " ", 
     RowBox[{
      SuperscriptBox["V", 
       TagBox[
        RowBox[{"(", 
         RowBox[{"0", ",", "1"}], ")"}],
        Derivative],
       MultilineFunction->None], "[", 
      RowBox[{"t", ",", "P"}], "]"}]}], "+", 
    RowBox[{"dt", " ", 
     SqrtBox[
      RowBox[{
       RowBox[{"-", "1"}], "+", 
       SuperscriptBox[
        RowBox[{"\[Rho]", "[", 
         RowBox[{"1", ",", "2"}], "]"}], "2"]}]], " ", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"\[Rho]", "[", 
         RowBox[{"1", ",", "2"}], "]"}], " ", 
        RowBox[{"\[Rho]", "[", 
         RowBox[{"1", ",", "3"}], "]"}]}], "-", 
       RowBox[{"\[Rho]", "[", 
        RowBox[{"2", ",", "3"}], "]"}]}], ")"}], " ", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{
        RowBox[{"-", "2"}], " ", "r", " ", 
        RowBox[{"V", "[", 
         RowBox[{"t", ",", "P"}], "]"}]}], "+", 
       RowBox[{"2", " ", "r", " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"q", "[", "1", "]"}], "+", 
          RowBox[{"q", "[", "2", "]"}], "+", 
          RowBox[{"q", "[", "3", "]"}]}], ")"}], " ", 
        RowBox[{
         SuperscriptBox["V", 
          TagBox[
           RowBox[{"(", 
            RowBox[{"0", ",", "1"}], ")"}],
           Derivative],
          MultilineFunction->None], "[", 
         RowBox[{"t", ",", "P"}], "]"}]}], "+", 
       RowBox[{
        SuperscriptBox[
         RowBox[{"q", "[", "1", "]"}], "2"], " ", 
        SuperscriptBox[
         RowBox[{"\[Sigma]", "[", "1", "]"}], "2"], " ", 
        RowBox[{
         SuperscriptBox["V", 
          TagBox[
           RowBox[{"(", 
            RowBox[{"0", ",", "2"}], ")"}],
           Derivative],
          MultilineFunction->None], "[", 
         RowBox[{"t", ",", "P"}], "]"}]}], "+", 
       RowBox[{"2", " ", 
        RowBox[{"q", "[", "1", "]"}], " ", 
        RowBox[{"q", "[", "2", "]"}], " ", 
        RowBox[{"\[Rho]", "[", 
         RowBox[{"1", ",", "2"}], "]"}], " ", 
        RowBox[{"\[Sigma]", "[", "1", "]"}], " ", 
        RowBox[{"\[Sigma]", "[", "2", "]"}], " ", 
        RowBox[{
         SuperscriptBox["V", 
          TagBox[
           RowBox[{"(", 
            RowBox[{"0", ",", "2"}], ")"}],
           Derivative],
          MultilineFunction->None], "[", 
         RowBox[{"t", ",", "P"}], "]"}]}], "+", 
       RowBox[{
        SuperscriptBox[
         RowBox[{"q", "[", "2", "]"}], "2"], " ", 
        SuperscriptBox[
         RowBox[{"\[Sigma]", "[", "2", "]"}], "2"], " ", 
        RowBox[{
         SuperscriptBox["V", 
          TagBox[
           RowBox[{"(", 
            RowBox[{"0", ",", "2"}], ")"}],
           Derivative],
          MultilineFunction->None], "[", 
         RowBox[{"t", ",", "P"}], "]"}]}], "+", 
       RowBox[{"2", " ", 
        RowBox[{"q", "[", "1", "]"}], " ", 
        RowBox[{"q", "[", "3", "]"}], " ", 
        RowBox[{"\[Rho]", "[", 
         RowBox[{"1", ",", "3"}], "]"}], " ", 
        RowBox[{"\[Sigma]", "[", "1", "]"}], " ", 
        RowBox[{"\[Sigma]", "[", "3", "]"}], " ", 
        RowBox[{
         SuperscriptBox["V", 
          TagBox[
           RowBox[{"(", 
            RowBox[{"0", ",", "2"}], ")"}],
           Derivative],
          MultilineFunction->None], "[", 
         RowBox[{"t", ",", "P"}], "]"}]}], "+", 
       RowBox[{"2", " ", 
        RowBox[{"q", "[", "2", "]"}], " ", 
        RowBox[{"q", "[", "3", "]"}], " ", 
        RowBox[{"\[Rho]", "[", 
         RowBox[{"2", ",", "3"}], "]"}], " ", 
        RowBox[{"\[Sigma]", "[", "2", "]"}], " ", 
        RowBox[{"\[Sigma]", "[", "3", "]"}], " ", 
        RowBox[{
         SuperscriptBox["V", 
          TagBox[
           RowBox[{"(", 
            RowBox[{"0", ",", "2"}], ")"}],
           Derivative],
          MultilineFunction->None], "[", 
         RowBox[{"t", ",", "P"}], "]"}]}], "+", 
       RowBox[{
        SuperscriptBox[
         RowBox[{"q", "[", "3", "]"}], "2"], " ", 
        SuperscriptBox[
         RowBox[{"\[Sigma]", "[", "3", "]"}], "2"], " ", 
        RowBox[{
         SuperscriptBox["V", 
          TagBox[
           RowBox[{"(", 
            RowBox[{"0", ",", "2"}], ")"}],
           Derivative],
          MultilineFunction->None], "[", 
         RowBox[{"t", ",", "P"}], "]"}]}], "+", 
       RowBox[{"2", " ", 
        RowBox[{
         SuperscriptBox["V", 
          TagBox[
           RowBox[{"(", 
            RowBox[{"1", ",", "0"}], ")"}],
           Derivative],
          MultilineFunction->None], "[", 
         RowBox[{"t", ",", "P"}], "]"}]}]}], ")"}]}]}], ")"}], "/", 
  RowBox[{"(", 
   RowBox[{"2", " ", 
    SqrtBox[
     RowBox[{
      RowBox[{"-", "1"}], "+", 
      SuperscriptBox[
       RowBox[{"\[Rho]", "[", 
        RowBox[{"1", ",", "2"}], "]"}], "2"]}]], " ", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{
       RowBox[{"\[Rho]", "[", 
        RowBox[{"1", ",", "2"}], "]"}], " ", 
       RowBox[{"\[Rho]", "[", 
        RowBox[{"1", ",", "3"}], "]"}]}], "-", 
      RowBox[{"\[Rho]", "[", 
       RowBox[{"2", ",", "3"}], "]"}]}], ")"}]}], ")"}]}]], "Output",
 CellChangeTimes->{{3.4746940943843265`*^9, 3.4746941006555376`*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Passport Options", "Title",
 CellChangeTimes->{{3.472302890794881*^9, 3.4723028954901495`*^9}, 
   3.4723970944625616`*^9, 3.473080213663621*^9}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"ToMaximise", "=", 
  RowBox[{"Collect", "[", 
   RowBox[{
    RowBox[{"Simplify", "[", 
     RowBox[{
      RowBox[{"FKE", "-", 
       RowBox[{"(", 
        RowBox[{"FKE", "/.", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"q", "[", "i", "]"}], "\[Rule]", "0"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "na"}], "}"}]}], "]"}]}], ")"}]}], "/.", 
      "Repla"}], "]"}], ",", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{
       SuperscriptBox["V", 
        TagBox[
         RowBox[{"(", 
          RowBox[{"0", ",", "1", ",", "1"}], ")"}],
         Derivative],
        MultilineFunction->None], "[", 
       RowBox[{"t", ",", "P", ",", 
        RowBox[{"S", "[", "1", "]"}]}], "]"}], ",", 
      RowBox[{
       SuperscriptBox["V", 
        TagBox[
         RowBox[{"(", 
          RowBox[{"0", ",", "2", ",", "0"}], ")"}],
         Derivative],
        MultilineFunction->None], "[", 
       RowBox[{"t", ",", "P", ",", 
        RowBox[{"S", "[", "1", "]"}]}], "]"}]}], "}"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.472306307848325*^9, 3.472306321676116*^9}, 
   3.472307738876175*^9, {3.472307775540272*^9, 3.4723078122203703`*^9}, {
   3.4723108709323187`*^9, 3.4723109089084907`*^9}, {3.4723123583723955`*^9, 
   3.4723123786285534`*^9}, 3.4723970944625616`*^9, {3.4724052322867413`*^9, 
   3.4724052380743513`*^9}, {3.472560432130551*^9, 3.4725604431205664`*^9}, {
   3.4728933420837746`*^9, 3.4728933427545757`*^9}, {3.4729930904694133`*^9, 
   3.47299310130083*^9}, {3.4729931355901065`*^9, 3.4729931390851603`*^9}, {
   3.472993348453376*^9, 3.4729933550859776`*^9}, {3.472994148525422*^9, 
   3.4729941806784163`*^9}, {3.472994351216036*^9, 3.472994355822356*^9}, {
   3.4729960311430902`*^9, 3.472996057085988*^9}, {3.4729964334455194`*^9, 
   3.4729964352855473`*^9}, {3.4730802485140824`*^9, 3.473080263162508*^9}, {
   3.473148295897027*^9, 3.473148315225461*^9}, {3.4731484217112474`*^9, 
   3.47314842269405*^9}, {3.473148465235324*^9, 3.473148562189494*^9}, {
   3.4731505913372607`*^9, 3.4731506260005217`*^9}, {3.474695466879737*^9, 
   3.4746954829789658`*^9}}],

Cell[BoxData[
 RowBox[{
  FractionBox["1", 
   RowBox[{"2", " ", 
    SuperscriptBox["P", "2"]}]], 
  RowBox[{
   RowBox[{"q", "[", "1", "]"}], " ", 
   SuperscriptBox[
    RowBox[{"\[Sigma]", "[", "1", "]"}], "2"], " ", 
   RowBox[{"(", 
    RowBox[{
     RowBox[{"2", " ", "P", " ", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{"-", "1"}], "+", 
        RowBox[{"q", "[", "1", "]"}]}], ")"}], " ", 
      RowBox[{"S", "[", "1", "]"}], " ", 
      RowBox[{
       SuperscriptBox["V", 
        TagBox[
         RowBox[{"(", 
          RowBox[{"0", ",", "0", ",", "1"}], ")"}],
         Derivative],
        MultilineFunction->None], "[", 
       RowBox[{"t", ",", "P", ",", 
        FractionBox[
         RowBox[{"S", "[", "1", "]"}], "P"]}], "]"}]}], "+", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{
        RowBox[{"-", "2"}], "+", 
        RowBox[{"q", "[", "1", "]"}]}], ")"}], " ", 
      SuperscriptBox[
       RowBox[{"S", "[", "1", "]"}], "2"], " ", 
      RowBox[{
       SuperscriptBox["V", 
        TagBox[
         RowBox[{"(", 
          RowBox[{"0", ",", "0", ",", "2"}], ")"}],
         Derivative],
        MultilineFunction->None], "[", 
       RowBox[{"t", ",", "P", ",", 
        FractionBox[
         RowBox[{"S", "[", "1", "]"}], "P"]}], "]"}]}], "+", 
     RowBox[{
      SuperscriptBox["P", "2"], " ", 
      RowBox[{"(", 
       RowBox[{
        RowBox[{
         RowBox[{"-", "2"}], " ", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"-", "1"}], "+", 
           RowBox[{"q", "[", "1", "]"}]}], ")"}], " ", 
         RowBox[{"S", "[", "1", "]"}], " ", 
         RowBox[{
          SuperscriptBox["V", 
           TagBox[
            RowBox[{"(", 
             RowBox[{"0", ",", "1", ",", "1"}], ")"}],
            Derivative],
           MultilineFunction->None], "[", 
          RowBox[{"t", ",", "P", ",", 
           FractionBox[
            RowBox[{"S", "[", "1", "]"}], "P"]}], "]"}]}], "+", 
        RowBox[{
         SuperscriptBox["P", "2"], " ", 
         RowBox[{"q", "[", "1", "]"}], " ", 
         RowBox[{
          SuperscriptBox["V", 
           TagBox[
            RowBox[{"(", 
             RowBox[{"0", ",", "2", ",", "0"}], ")"}],
            Derivative],
           MultilineFunction->None], "[", 
          RowBox[{"t", ",", "P", ",", 
           FractionBox[
            RowBox[{"S", "[", "1", "]"}], "P"]}], "]"}]}]}], ")"}]}]}], 
    ")"}]}]}]], "Output",
 CellChangeTimes->{
  3.473148562548295*^9, {3.47314863348162*^9, 3.4731486579268627`*^9}, {
   3.473149303523799*^9, 3.4731493239910345`*^9}, {3.473150574473631*^9, 
   3.473150626967724*^9}, 3.4731507272457*^9, 3.47315185451888*^9, 
   3.473151924017002*^9, 3.4746928406257243`*^9, 3.4746946011200166`*^9, 
   3.474695415961248*^9, {3.4746954514981103`*^9, 3.474695483134966*^9}, 
   3.4746981820617065`*^9, 3.4746982409206095`*^9, 3.474701293192637*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Maximize", "[", 
  RowBox[{
   RowBox[{"{", 
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           SuperscriptBox["q1", "2"], " ", 
           SuperscriptBox["s1", "2"]}], "+", 
          RowBox[{
           SuperscriptBox["q2", "2"], " ", 
           SuperscriptBox["s2", "2"]}], "+", 
          RowBox[{
          "2", " ", "q1", " ", "q2", " ", "s1", " ", "s2", " ", "\[Rho]"}]}], 
         ")"}], "/.", 
        RowBox[{"s1", "->", "0.7"}]}], "/.", 
       RowBox[{"s2", "->", "0.8"}]}], "/.", 
      RowBox[{"\[Rho]", "\[Rule]", 
       RowBox[{"-", ".1"}]}]}], ",", 
     RowBox[{
      RowBox[{
       RowBox[{"Abs", "[", "q1", "]"}], "+", 
       RowBox[{"Abs", "[", "q2", "]"}]}], "==", "1"}]}], "}"}], ",", 
   RowBox[{"{", 
    RowBox[{"q1", ",", "q2"}], "}"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.4730811811159205`*^9, 3.4730811991651525`*^9}, {
   3.4730813889082856`*^9, 3.473081389844287*^9}, 3.4730814738358345`*^9, {
   3.4730815705404043`*^9, 3.473081609992874*^9}, {3.4730818365862865`*^9, 
   3.473081877005957*^9}, {3.473081908720813*^9, 3.4730819245236406`*^9}, {
   3.473151942284634*^9, 3.4731519672446775`*^9}}],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"0.6400000017695786`", ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"q1", "\[Rule]", 
      RowBox[{"-", "5.23649948431784`*^-9"}]}], ",", 
     RowBox[{"q2", "\[Rule]", 
      RowBox[{"-", "1.000000001840677`"}]}]}], "}"}]}], "}"}]], "Output",
 CellChangeTimes->{{3.473081357630231*^9, 3.4730814744286356`*^9}, {
  3.4730815405259523`*^9, 3.473081644687335*^9}, {3.4730818327018795`*^9, 
  3.473081925147642*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{
        SuperscriptBox["q1", "2"], " ", 
        SuperscriptBox["s1", "2"]}], "+", 
       RowBox[{
        SuperscriptBox["q2", "2"], " ", 
        SuperscriptBox["s2", "2"]}], "+", 
       RowBox[{
       "2", " ", "q1", " ", "q2", " ", "s1", " ", "s2", " ", "\[Rho]"}]}], "/.", 
      RowBox[{"s1", "->", "0.7"}]}], "/.", 
     RowBox[{"s2", "->", "0.8"}]}], "/.", 
    RowBox[{"\[Rho]", "\[Rule]", 
     RowBox[{"-", "1"}]}]}], "/.", 
   RowBox[{"q1", "\[Rule]", "1"}]}], "/.", 
  RowBox[{"q2", "\[Rule]", "0"}]}]], "Input",
 CellChangeTimes->{{3.473081480325446*^9, 3.473081494958272*^9}, {
  3.4730816008044577`*^9, 3.4730816045328646`*^9}, {3.4730818702979455`*^9, 
  3.4730819346948586`*^9}}],

Cell[BoxData["0.48999999999999994`"], "Output",
 CellChangeTimes->{
  3.473081495426273*^9, {3.473081597622052*^9, 3.473081627262104*^9}, {
   3.4730818633247333`*^9, 3.473081934757259*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"FKE", "/.", 
  RowBox[{"{", 
   RowBox[{
    RowBox[{
     RowBox[{"q", "[", "1", "]"}], "\[Rule]", "1"}], ",", 
    RowBox[{
     RowBox[{"q", "[", "2", "]"}], "\[Rule]", "0"}], ",", 
    RowBox[{
     RowBox[{"q", "[", "3", "]"}], "\[Rule]", "0"}]}], "}"}]}]], "Input",
 CellChangeTimes->{{3.473151984779108*^9, 3.473151998054732*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"-", "r"}], " ", 
   RowBox[{"V", "[", 
    RowBox[{"t", ",", "P"}], "]"}]}], "+", 
  RowBox[{"r", " ", 
   RowBox[{
    SuperscriptBox["V", 
     TagBox[
      RowBox[{"(", 
       RowBox[{"0", ",", "1"}], ")"}],
      Derivative],
     MultilineFunction->None], "[", 
    RowBox[{"t", ",", "P"}], "]"}]}], "+", 
  RowBox[{
   FractionBox["1", "2"], " ", 
   SuperscriptBox[
    RowBox[{"\[Sigma]", "[", "1", "]"}], "2"], " ", 
   SuperscriptBox[
    RowBox[{"\[Sigma]", "[", 
     RowBox[{"1", ",", "1"}], "]"}], "2"], " ", 
   RowBox[{
    SuperscriptBox["V", 
     TagBox[
      RowBox[{"(", 
       RowBox[{"0", ",", "2"}], ")"}],
      Derivative],
     MultilineFunction->None], "[", 
    RowBox[{"t", ",", "P"}], "]"}]}], "+", 
  RowBox[{
   SuperscriptBox["V", 
    TagBox[
     RowBox[{"(", 
      RowBox[{"1", ",", "0"}], ")"}],
     Derivative],
    MultilineFunction->None], "[", 
   RowBox[{"t", ",", "P"}], "]"}]}]], "Output",
 CellChangeTimes->{{3.473151995465127*^9, 3.473151998538333*^9}}]
}, Open  ]],

Cell[BoxData[
 RowBox[{"Also", " ", "das", " ", "q", " ", "f\[UDoubleDot]r", " ", "die", 
  " ", "gr\[ODoubleDot]\[SZ]te", " ", "Vola", " ", "muss", " ", "eins", " ", 
  RowBox[{"sein", ".", " ", "und"}], " ", "der", " ", "Preis", " ", 
  "entspricht", " ", "einem", " ", "Put", " ", "auf", " ", "ein", " ", 
  "unterlaying", " ", "mit", " ", "dieser", " ", "vola", " ", "und", " ", 
  "einem", " ", "kurs", " ", "vom", " ", "portfoliowert", " ", "und", " ", 
  "stirke", " ", 
  RowBox[{"gewinnstrike", "."}]}]], "Input",
 CellChangeTimes->{{3.4730819492652845`*^9, 3.47308200353778*^9}}],

Cell[CellGroupData[{

Cell["ALSO: q=1", "Subsection",
 CellChangeTimes->{{3.4728939053071637`*^9, 3.4728939093319707`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"sei", " ", "a"}], ">", 
    RowBox[{"0", " ", "c"}], "\[LessEqual]", "q", "\[LessEqual]", 
    RowBox[{"d", " ", "dann", " ", "ist", " ", 
     RowBox[{"ArgMax", "[", 
      RowBox[{"q", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"a", " ", "q"}], "+", "b"}], ")"}]}], "]"}], " ", "gleich", 
     " ", "A"}]}], "*)"}], 
  RowBox[{
   RowBox[{"A", "[", 
    RowBox[{"a_", ",", " ", "b_", ",", " ", "c_", ",", " ", "d_"}], "]"}], 
   " ", ":=", " ", 
   RowBox[{"Piecewise", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{"d", ",", " ", 
        RowBox[{
         RowBox[{"Abs", "[", 
          RowBox[{"c", " ", "+", " ", 
           RowBox[{
            RowBox[{"b", "/", "2"}], "/", "a"}]}], "]"}], " ", "<", " ", 
         RowBox[{"Abs", "[", 
          RowBox[{"d", " ", "+", " ", 
           RowBox[{
            RowBox[{"b", "/", "2"}], "/", "a"}]}], "]"}]}]}], "}"}], "}"}], 
     ",", " ", "c"}], "]"}]}]}]], "Input",
 CellChangeTimes->{{3.472312318157095*^9, 3.4723123404443693`*^9}, {
   3.4723125696294785`*^9, 3.472312576724884*^9}, {3.472312643405698*^9, 
   3.472312646468873*^9}, 3.4723970944625616`*^9, {3.4725692695480433`*^9, 
   3.472569270828046*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["\<\
F\[UDoubleDot]r ausschlie\[SZ]lich Long-Positionen mit Anfangskapital M und \
Payoff max(P(t),0)\
\>", "Subsubtitle",
 CellChangeTimes->{{3.472306347186575*^9, 3.4723063618504133`*^9}, {
   3.472308494531396*^9, 3.4723085235470552`*^9}, {3.4723091613075333`*^9, 
   3.472309170395053*^9}, {3.472309674754901*^9, 3.4723096771230364`*^9}, {
   3.4723097519313154`*^9, 3.4723097590187206`*^9}, {3.4723913766744*^9, 
   3.472391408874445*^9}, 3.4723970944625616`*^9}],

Cell["also 0 <= q <= (P+M)/S", "Text",
 CellChangeTimes->{{3.472303393378627*^9, 3.4723034308737717`*^9}, {
   3.472303520482897*^9, 3.4723036546665716`*^9}, {3.4723041538901253`*^9, 
   3.472304169057993*^9}, {3.4723042835955443`*^9, 3.472304304977767*^9}, {
   3.472304914034603*^9, 3.4723049140906067`*^9}, {3.472306372834042*^9, 
   3.4723063757142067`*^9}, {3.4723084876670036`*^9, 
   3.4723084892580943`*^9}, {3.4723085523867054`*^9, 
   3.4723085677625847`*^9}, {3.47230976705118*^9, 3.472309767538208*^9}, {
   3.4723100471472006`*^9, 3.4723100688424416`*^9}, {3.472310722546831*^9, 
   3.47231072567501*^9}, {3.4723124109714036`*^9, 3.472312446122414*^9}, 
   3.4723970944625616`*^9}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"oq1", "=", 
  RowBox[{"Simplify", "[", 
   RowBox[{"A", "[", 
    RowBox[{
     RowBox[{
      SuperscriptBox["V", 
       TagBox[
        RowBox[{"(", 
         RowBox[{"0", ",", "2", ",", "0"}], ")"}],
        Derivative],
       MultilineFunction->None], "[", 
      RowBox[{"S", ",", "P", ",", "t"}], "]"}], ",", 
     RowBox[{"2", 
      RowBox[{
       SuperscriptBox["V", 
        TagBox[
         RowBox[{"(", 
          RowBox[{"1", ",", "1", ",", "0"}], ")"}],
         Derivative],
        MultilineFunction->None], "[", 
       RowBox[{"S", ",", "P", ",", "t"}], "]"}]}], ",", "0", ",", 
     FractionBox[
      RowBox[{"M", "+", "P"}], "S"]}], "]"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.4723104800979643`*^9, 3.472310482099078*^9}, {
   3.472310639635089*^9, 3.4723107005555735`*^9}, {3.4723124290614386`*^9, 
   3.472312453116814*^9}, 3.472315666844629*^9, {3.472390206248675*^9, 
   3.4723902129386845`*^9}, {3.472390280408779*^9, 3.4723902858987865`*^9}, 
   3.4723903866489277`*^9, 3.4723907671514626`*^9, {3.472391580534685*^9, 
   3.472391581484687*^9}, {3.4723916976368504`*^9, 3.472391697866851*^9}, 
   3.4723970944625616`*^9}],

Cell[BoxData[
 RowBox[{"\[Piecewise]", GridBox[{
    {
     FractionBox[
      RowBox[{"M", "+", "P"}], "S"], 
     RowBox[{
      RowBox[{"Abs", "[", 
       FractionBox[
        RowBox[{
         SuperscriptBox["V", 
          TagBox[
           RowBox[{"(", 
            RowBox[{"1", ",", "1", ",", "0"}], ")"}],
           Derivative],
          MultilineFunction->None], "[", 
         RowBox[{"S", ",", "P", ",", "t"}], "]"}], 
        RowBox[{
         SuperscriptBox["V", 
          TagBox[
           RowBox[{"(", 
            RowBox[{"0", ",", "2", ",", "0"}], ")"}],
           Derivative],
          MultilineFunction->None], "[", 
         RowBox[{"S", ",", "P", ",", "t"}], "]"}]], "]"}], "<", 
      RowBox[{"Abs", "[", 
       RowBox[{
        FractionBox[
         RowBox[{"M", "+", "P"}], "S"], "+", 
        FractionBox[
         RowBox[{
          SuperscriptBox["V", 
           TagBox[
            RowBox[{"(", 
             RowBox[{"1", ",", "1", ",", "0"}], ")"}],
            Derivative],
           MultilineFunction->None], "[", 
          RowBox[{"S", ",", "P", ",", "t"}], "]"}], 
         RowBox[{
          SuperscriptBox["V", 
           TagBox[
            RowBox[{"(", 
             RowBox[{"0", ",", "2", ",", "0"}], ")"}],
            Derivative],
           MultilineFunction->None], "[", 
          RowBox[{"S", ",", "P", ",", "t"}], "]"}]]}], "]"}]}]},
    {"0", 
     TagBox["True",
      "PiecewiseDefault",
      AutoDelete->False,
      DeletionWarning->True]}
   },
   GridBoxAlignment->{
    "Columns" -> {{Left}}, "ColumnsIndexed" -> {}, "Rows" -> {{Baseline}}, 
     "RowsIndexed" -> {}},
   GridBoxItemSize->{
    "Columns" -> {{Automatic}}, "ColumnsIndexed" -> {}, "Rows" -> {{1.}}, 
     "RowsIndexed" -> {}},
   GridBoxSpacings->{"Columns" -> {
       Offset[0.27999999999999997`], {
        Offset[0.84]}, 
       Offset[0.27999999999999997`]}, "ColumnsIndexed" -> {}, "Rows" -> {
       Offset[0.2], {
        Offset[0.4]}, 
       Offset[0.2]}, "RowsIndexed" -> {}}]}]], "Output",
 GeneratedCell->False,
 CellAutoOverwrite->False,
 CellChangeTimes->{{3.472310682346532*^9, 3.472310700933595*^9}, 
   3.4723124540678687`*^9, {3.4723126350502205`*^9, 3.472312648520991*^9}, 
   3.472314727681912*^9, 3.472315667698678*^9, {3.472387650825212*^9, 
   3.4723876663940396`*^9}, 3.4723902138986855`*^9, {3.472390273658769*^9, 
   3.472390288928791*^9}, {3.47239038152892*^9, 3.472390387248928*^9}, 
   3.472390767551463*^9, {3.4723915693346696`*^9, 3.4723915869346943`*^9}, 
   3.4723916450547757`*^9, 3.4723916983668513`*^9, 3.4723970944625616`*^9}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["\<\
F\[UDoubleDot]r Long- und Short Positionen, Anfangskapital M und aufs Kapital \
limitierte Short positionen und Payoff max(P(t),0)\
\>", "Subsubtitle",
 CellChangeTimes->{{3.472306347186575*^9, 3.4723063618504133`*^9}, {
   3.472308494531396*^9, 3.4723085235470552`*^9}, {3.4723091613075333`*^9, 
   3.472309170395053*^9}, {3.472309674754901*^9, 3.4723096771230364`*^9}, {
   3.4723097519313154`*^9, 3.4723097590187206`*^9}, {3.472391360289974*^9, 
   3.4723913663271847`*^9}, {3.4723914220744634`*^9, 
   3.4723914308244753`*^9}, {3.4723917027268577`*^9, 3.472391703006858*^9}, {
   3.4723917650869446`*^9, 3.472391784786972*^9}, 3.4723970944625616`*^9}],

Cell["also -(P+M)/S <= q <= (P+M)/S", "Text",
 CellChangeTimes->{{3.472303393378627*^9, 3.4723034308737717`*^9}, {
   3.472303520482897*^9, 3.4723036546665716`*^9}, {3.4723041538901253`*^9, 
   3.472304169057993*^9}, {3.4723042835955443`*^9, 3.472304304977767*^9}, {
   3.472304914034603*^9, 3.4723049140906067`*^9}, {3.472306372834042*^9, 
   3.4723063757142067`*^9}, {3.4723084876670036`*^9, 
   3.4723084892580943`*^9}, {3.4723085523867054`*^9, 
   3.4723085677625847`*^9}, {3.47230976705118*^9, 3.472309767538208*^9}, {
   3.4723100471472006`*^9, 3.4723100688424416`*^9}, {3.472310722546831*^9, 
   3.47231072567501*^9}, {3.4723124109714036`*^9, 3.472312446122414*^9}, {
   3.4723917877369766`*^9, 3.472391793026984*^9}, 3.4723970944625616`*^9}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"oq2", "=", 
  RowBox[{"Simplify", "[", 
   RowBox[{"A", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"e", "^", "2"}], " ", 
      SuperscriptBox["s", "2"], " ", 
      RowBox[{
       SuperscriptBox["H", 
        TagBox[
         RowBox[{"(", 
          RowBox[{"2", ",", "0"}], ")"}],
         Derivative],
        MultilineFunction->None], "[", 
       RowBox[{"e", ",", "t"}], "]"}]}], ",", 
     RowBox[{"2", " ", "r", " ", 
      RowBox[{
       SuperscriptBox["H", 
        TagBox[
         RowBox[{"(", 
          RowBox[{"1", ",", "0"}], ")"}],
         Derivative],
        MultilineFunction->None], "[", 
       RowBox[{"e", ",", "t"}], "]"}], " ", "e"}], ",", 
     RowBox[{"-", "1"}], ",", "1"}], "]"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.4723104800979643`*^9, 3.472310482099078*^9}, {
   3.472310639635089*^9, 3.4723107005555735`*^9}, {3.4723124290614386`*^9, 
   3.472312453116814*^9}, 3.472315666844629*^9, {3.472390206248675*^9, 
   3.4723902129386845`*^9}, {3.472390280408779*^9, 3.4723902858987865`*^9}, 
   3.4723903866489277`*^9, 3.4723907671514626`*^9, {3.4723917961069884`*^9, 
   3.4723917972269897`*^9}, 3.4723961254196386`*^9, 3.4723970944625616`*^9, {
   3.4728934543571715`*^9, 3.4728934705656*^9}, {3.4728935163984804`*^9, 
   3.4728935185668845`*^9}}],

Cell[BoxData[
 RowBox[{"\[Piecewise]", GridBox[{
    {"1", 
     RowBox[{
      RowBox[{"Abs", "[", 
       RowBox[{
        RowBox[{"-", "1"}], "+", 
        FractionBox[
         RowBox[{"r", " ", 
          RowBox[{
           SuperscriptBox["H", 
            TagBox[
             RowBox[{"(", 
              RowBox[{"1", ",", "0"}], ")"}],
             Derivative],
            MultilineFunction->None], "[", 
           RowBox[{"e", ",", "t"}], "]"}]}], 
         RowBox[{"e", " ", 
          SuperscriptBox["s", "2"], " ", 
          RowBox[{
           SuperscriptBox["H", 
            TagBox[
             RowBox[{"(", 
              RowBox[{"2", ",", "0"}], ")"}],
             Derivative],
            MultilineFunction->None], "[", 
           RowBox[{"e", ",", "t"}], "]"}]}]]}], "]"}], "<", 
      RowBox[{"Abs", "[", 
       RowBox[{"1", "+", 
        FractionBox[
         RowBox[{"r", " ", 
          RowBox[{
           SuperscriptBox["H", 
            TagBox[
             RowBox[{"(", 
              RowBox[{"1", ",", "0"}], ")"}],
             Derivative],
            MultilineFunction->None], "[", 
           RowBox[{"e", ",", "t"}], "]"}]}], 
         RowBox[{"e", " ", 
          SuperscriptBox["s", "2"], " ", 
          RowBox[{
           SuperscriptBox["H", 
            TagBox[
             RowBox[{"(", 
              RowBox[{"2", ",", "0"}], ")"}],
             Derivative],
            MultilineFunction->None], "[", 
           RowBox[{"e", ",", "t"}], "]"}]}]]}], "]"}]}]},
    {
     RowBox[{"-", "1"}], 
     TagBox["True",
      "PiecewiseDefault",
      AutoDelete->False,
      DeletionWarning->True]}
   },
   GridBoxAlignment->{
    "Columns" -> {{Left}}, "ColumnsIndexed" -> {}, "Rows" -> {{Baseline}}, 
     "RowsIndexed" -> {}},
   GridBoxItemSize->{
    "Columns" -> {{Automatic}}, "ColumnsIndexed" -> {}, "Rows" -> {{1.}}, 
     "RowsIndexed" -> {}},
   GridBoxSpacings->{"Columns" -> {
       Offset[0.27999999999999997`], {
        Offset[0.84]}, 
       Offset[0.27999999999999997`]}, "ColumnsIndexed" -> {}, "Rows" -> {
       Offset[0.2], {
        Offset[0.4]}, 
       Offset[0.2]}, "RowsIndexed" -> {}}]}]], "Output",
 GeneratedCell->False,
 CellAutoOverwrite->False,
 CellChangeTimes->{{3.472310682346532*^9, 3.472310700933595*^9}, 
   3.4723124540678687`*^9, {3.4723126350502205`*^9, 3.472312648520991*^9}, 
   3.472314727681912*^9, 3.472315667698678*^9, {3.472387650825212*^9, 
   3.4723876663940396`*^9}, 3.4723902138986855`*^9, {3.472390273658769*^9, 
   3.472390288928791*^9}, {3.47239038152892*^9, 3.472390387248928*^9}, 
   3.472390767551463*^9, 3.472391797856991*^9, 3.4723961268236413`*^9, 
   3.4723970944625616`*^9, 3.4728934329539337`*^9, 3.472893471782402*^9, 
   3.472893519518486*^9}],

Cell[BoxData[
 RowBox[{"\[Piecewise]", GridBox[{
    {
     FractionBox[
      RowBox[{"M", "+", "P"}], "S"], 
     RowBox[{
      RowBox[{"Abs", "[", 
       RowBox[{
        FractionBox[
         RowBox[{"M", "+", "P"}], "S"], "-", 
        FractionBox[
         RowBox[{"r", " ", 
          RowBox[{
           SuperscriptBox["H", 
            TagBox[
             RowBox[{"(", 
              RowBox[{"1", ",", "0"}], ")"}],
             Derivative],
            MultilineFunction->None], "[", 
           RowBox[{"e", ",", "t"}], "]"}]}], 
         RowBox[{"e", " ", 
          SuperscriptBox["s", "2"], " ", 
          RowBox[{
           SuperscriptBox["H", 
            TagBox[
             RowBox[{"(", 
              RowBox[{"2", ",", "0"}], ")"}],
             Derivative],
            MultilineFunction->None], "[", 
           RowBox[{"e", ",", "t"}], "]"}]}]]}], "]"}], "<", 
      RowBox[{"Abs", "[", 
       RowBox[{
        FractionBox[
         RowBox[{"M", "+", "P"}], "S"], "+", 
        FractionBox[
         RowBox[{"r", " ", 
          RowBox[{
           SuperscriptBox["H", 
            TagBox[
             RowBox[{"(", 
              RowBox[{"1", ",", "0"}], ")"}],
             Derivative],
            MultilineFunction->None], "[", 
           RowBox[{"e", ",", "t"}], "]"}]}], 
         RowBox[{"e", " ", 
          SuperscriptBox["s", "2"], " ", 
          RowBox[{
           SuperscriptBox["H", 
            TagBox[
             RowBox[{"(", 
              RowBox[{"2", ",", "0"}], ")"}],
             Derivative],
            MultilineFunction->None], "[", 
           RowBox[{"e", ",", "t"}], "]"}]}]]}], "]"}]}]},
    {
     RowBox[{"-", 
      FractionBox[
       RowBox[{"M", "+", "P"}], "S"]}], 
     TagBox["True",
      "PiecewiseDefault",
      AutoDelete->False,
      DeletionWarning->True]}
   },
   GridBoxAlignment->{
    "Columns" -> {{Left}}, "ColumnsIndexed" -> {}, "Rows" -> {{Baseline}}, 
     "RowsIndexed" -> {}},
   GridBoxItemSize->{
    "Columns" -> {{Automatic}}, "ColumnsIndexed" -> {}, "Rows" -> {{1.}}, 
     "RowsIndexed" -> {}},
   GridBoxSpacings->{"Columns" -> {
       Offset[0.27999999999999997`], {
        Offset[0.84]}, 
       Offset[0.27999999999999997`]}, "ColumnsIndexed" -> {}, "Rows" -> {
       Offset[0.2], {
        Offset[0.4]}, 
       Offset[0.2]}, "RowsIndexed" -> {}}]}]], "Output",
 GeneratedCell->False,
 CellAutoOverwrite->False,
 CellChangeTimes->{{3.472310682346532*^9, 3.472310700933595*^9}, 
   3.4723124540678687`*^9, {3.4723126350502205`*^9, 3.472312648520991*^9}, 
   3.472314727681912*^9, 3.472315667698678*^9, {3.472387650825212*^9, 
   3.4723876663940396`*^9}, 3.4723902138986855`*^9, {3.472390273658769*^9, 
   3.472390288928791*^9}, {3.47239038152892*^9, 3.472390387248928*^9}, 
   3.472390767551463*^9, 3.472391797856991*^9, 3.4723961268236413`*^9, 
   3.4723970944625616`*^9, 3.4728934329539337`*^9, 3.472893471782402*^9}],

Cell[BoxData[
 RowBox[{"\[Piecewise]", GridBox[{
    {
     FractionBox[
      RowBox[{"M", "+", "P"}], "S"], 
     RowBox[{
      RowBox[{"Abs", "[", 
       RowBox[{
        FractionBox[
         RowBox[{"M", "+", "P"}], "S"], "-", 
        FractionBox[
         RowBox[{
          SuperscriptBox["V", 
           TagBox[
            RowBox[{"(", 
             RowBox[{"1", ",", "1", ",", "0"}], ")"}],
            Derivative],
           MultilineFunction->None], "[", 
          RowBox[{"S", ",", "P", ",", "t"}], "]"}], 
         RowBox[{
          SuperscriptBox["V", 
           TagBox[
            RowBox[{"(", 
             RowBox[{"0", ",", "2", ",", "0"}], ")"}],
            Derivative],
           MultilineFunction->None], "[", 
          RowBox[{"S", ",", "P", ",", "t"}], "]"}]]}], "]"}], "<", 
      RowBox[{"Abs", "[", 
       RowBox[{
        FractionBox[
         RowBox[{"M", "+", "P"}], "S"], "+", 
        FractionBox[
         RowBox[{
          SuperscriptBox["V", 
           TagBox[
            RowBox[{"(", 
             RowBox[{"1", ",", "1", ",", "0"}], ")"}],
            Derivative],
           MultilineFunction->None], "[", 
          RowBox[{"S", ",", "P", ",", "t"}], "]"}], 
         RowBox[{
          SuperscriptBox["V", 
           TagBox[
            RowBox[{"(", 
             RowBox[{"0", ",", "2", ",", "0"}], ")"}],
            Derivative],
           MultilineFunction->None], "[", 
          RowBox[{"S", ",", "P", ",", "t"}], "]"}]]}], "]"}]}]},
    {
     RowBox[{"-", 
      FractionBox[
       RowBox[{"M", "+", "P"}], "S"]}], 
     TagBox["True",
      "PiecewiseDefault",
      AutoDelete->False,
      DeletionWarning->True]}
   },
   GridBoxAlignment->{
    "Columns" -> {{Left}}, "ColumnsIndexed" -> {}, "Rows" -> {{Baseline}}, 
     "RowsIndexed" -> {}},
   GridBoxItemSize->{
    "Columns" -> {{Automatic}}, "ColumnsIndexed" -> {}, "Rows" -> {{1.}}, 
     "RowsIndexed" -> {}},
   GridBoxSpacings->{"Columns" -> {
       Offset[0.27999999999999997`], {
        Offset[0.84]}, 
       Offset[0.27999999999999997`]}, "ColumnsIndexed" -> {}, "Rows" -> {
       Offset[0.2], {
        Offset[0.4]}, 
       Offset[0.2]}, "RowsIndexed" -> {}}]}]], "Output",
 GeneratedCell->False,
 CellAutoOverwrite->False,
 CellChangeTimes->{{3.472310682346532*^9, 3.472310700933595*^9}, 
   3.4723124540678687`*^9, {3.4723126350502205`*^9, 3.472312648520991*^9}, 
   3.472314727681912*^9, 3.472315667698678*^9, {3.472387650825212*^9, 
   3.4723876663940396`*^9}, 3.4723902138986855`*^9, {3.472390273658769*^9, 
   3.472390288928791*^9}, {3.47239038152892*^9, 3.472390387248928*^9}, 
   3.472390767551463*^9, 3.472391797856991*^9, 3.4723961268236413`*^9, 
   3.4723970944625616`*^9, 3.4728934329539337`*^9}],

Cell[BoxData[
 RowBox[{"\[Piecewise]", GridBox[{
    {
     FractionBox[
      RowBox[{"M", "+", "P"}], "S"], 
     RowBox[{
      RowBox[{"Abs", "[", 
       RowBox[{
        FractionBox[
         RowBox[{"M", "+", "P"}], "S"], "-", 
        FractionBox[
         RowBox[{
          SuperscriptBox["V", 
           TagBox[
            RowBox[{"(", 
             RowBox[{"1", ",", "1", ",", "0"}], ")"}],
            Derivative],
           MultilineFunction->None], "[", 
          RowBox[{"S", ",", "P", ",", "t"}], "]"}], 
         RowBox[{
          SuperscriptBox["V", 
           TagBox[
            RowBox[{"(", 
             RowBox[{"0", ",", "2", ",", "0"}], ")"}],
            Derivative],
           MultilineFunction->None], "[", 
          RowBox[{"S", ",", "P", ",", "t"}], "]"}]]}], "]"}], "<", 
      RowBox[{"Abs", "[", 
       RowBox[{
        FractionBox[
         RowBox[{"M", "+", "P"}], "S"], "+", 
        FractionBox[
         RowBox[{
          SuperscriptBox["V", 
           TagBox[
            RowBox[{"(", 
             RowBox[{"1", ",", "1", ",", "0"}], ")"}],
            Derivative],
           MultilineFunction->None], "[", 
          RowBox[{"S", ",", "P", ",", "t"}], "]"}], 
         RowBox[{
          SuperscriptBox["V", 
           TagBox[
            RowBox[{"(", 
             RowBox[{"0", ",", "2", ",", "0"}], ")"}],
            Derivative],
           MultilineFunction->None], "[", 
          RowBox[{"S", ",", "P", ",", "t"}], "]"}]]}], "]"}]}]},
    {
     RowBox[{"-", 
      FractionBox[
       RowBox[{"M", "+", "P"}], "S"]}], 
     TagBox["True",
      "PiecewiseDefault",
      AutoDelete->False,
      DeletionWarning->True]}
   },
   GridBoxAlignment->{
    "Columns" -> {{Left}}, "ColumnsIndexed" -> {}, "Rows" -> {{Baseline}}, 
     "RowsIndexed" -> {}},
   GridBoxItemSize->{
    "Columns" -> {{Automatic}}, "ColumnsIndexed" -> {}, "Rows" -> {{1.}}, 
     "RowsIndexed" -> {}},
   GridBoxSpacings->{"Columns" -> {
       Offset[0.27999999999999997`], {
        Offset[0.84]}, 
       Offset[0.27999999999999997`]}, "ColumnsIndexed" -> {}, "Rows" -> {
       Offset[0.2], {
        Offset[0.4]}, 
       Offset[0.2]}, "RowsIndexed" -> {}}]}]], "Output",
 GeneratedCell->False,
 CellAutoOverwrite->False,
 CellChangeTimes->{{3.472310682346532*^9, 3.472310700933595*^9}, 
   3.4723124540678687`*^9, {3.4723126350502205`*^9, 3.472312648520991*^9}, 
   3.472314727681912*^9, 3.472315667698678*^9, {3.472387650825212*^9, 
   3.4723876663940396`*^9}, 3.4723902138986855`*^9, {3.472390273658769*^9, 
   3.472390288928791*^9}, {3.47239038152892*^9, 3.472390387248928*^9}, 
   3.472390767551463*^9, 3.472391797856991*^9, 3.4723961268236413`*^9, 
   3.4723970944625616`*^9}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["F\[UDoubleDot]r -1<= q <= 1", "Subsubtitle",
 CellChangeTimes->{{3.472306347186575*^9, 3.4723063618504133`*^9}, {
   3.472308494531396*^9, 3.4723085235470552`*^9}, {3.4723091613075333`*^9, 
   3.472309170395053*^9}, {3.472309674754901*^9, 3.4723096771230364`*^9}, {
   3.4723097519313154`*^9, 3.4723097590187206`*^9}, {3.4723149792272997`*^9, 
   3.4723150000344896`*^9}, {3.472387672899251*^9, 3.472387673414052*^9}, 
   3.4723970944625616`*^9}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Payoff", "=", 
  RowBox[{"Simplify", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"P", "/", "S"}], "/.", 
     RowBox[{"V", "\[Rule]", "Vr"}]}], "/.", 
    RowBox[{"P", "\[Rule]", 
     RowBox[{"e", "*", "S"}]}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.472315593628441*^9, 3.4723156004848337`*^9}, 
   3.472389273811553*^9, {3.4723893206516185`*^9, 3.4723893393636465`*^9}, 
   3.4723970944625616`*^9}],

Cell[BoxData["e"], "Output",
 GeneratedCell->False,
 CellAutoOverwrite->False,
 CellChangeTimes->{3.472389339963648*^9, 3.4723970944625616`*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"StrategiePayoff", "=", 
  RowBox[{"Simplify", "[", 
   RowBox[{
    RowBox[{
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"(", 
         RowBox[{"FKE", "-", 
          RowBox[{"(", 
           RowBox[{"FKE", "/.", 
            RowBox[{"q", "\[Rule]", "0"}]}], ")"}]}], ")"}], "/", "S"}], "/", 
       RowBox[{"s", "^", "2"}]}], "*", "2"}], "/.", 
     RowBox[{"V", "\[Rule]", "Vr"}]}], "/.", 
    RowBox[{"P", "\[Rule]", 
     RowBox[{"e", "*", "S"}]}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.4723104800979643`*^9, 3.472310482099078*^9}, {
   3.472310639635089*^9, 3.4723107005555735`*^9}, {3.4723124290614386`*^9, 
   3.472312453116814*^9}, {3.4723150070288897`*^9, 3.472315011388139*^9}, {
   3.4723154791018906`*^9, 3.472315496468884*^9}, 3.4723970944625616`*^9}],

Cell[BoxData[
 RowBox[{"q", " ", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{
     RowBox[{"-", "2"}], " ", "e"}], "+", "q"}], ")"}], " ", 
  RowBox[{
   SuperscriptBox["H", 
    TagBox[
     RowBox[{"(", 
      RowBox[{"2", ",", "0"}], ")"}],
     Derivative],
    MultilineFunction->None], "[", 
   RowBox[{"e", ",", "t"}], "]"}]}]], "Output",
 GeneratedCell->False,
 CellAutoOverwrite->False,
 CellChangeTimes->{{3.472310682346532*^9, 3.472310700933595*^9}, 
   3.4723124540678687`*^9, {3.4723126350502205`*^9, 3.472312648520991*^9}, 
   3.472314727681912*^9, 3.4723150118481655`*^9, {3.4723154920366306`*^9, 
   3.472315496835905*^9}, {3.472389192659438*^9, 3.472389203729453*^9}, 
   3.4723970944625616`*^9}]
}, Open  ]],

Cell[TextData[{
 "Hier kann ",
 Cell[BoxData[
  RowBox[{
   SuperscriptBox["H", 
    TagBox[
     RowBox[{"(", 
      RowBox[{"2", ",", "0"}], ")"}],
     Derivative],
    MultilineFunction->None], "[", 
   RowBox[{"e", ",", "t"}], "]"}]], "Output",
  CellChangeTimes->{{3.472310682346532*^9, 3.472310700933595*^9}, 
    3.4723124540678687`*^9, {3.4723126350502205`*^9, 3.472312648520991*^9}, 
    3.472314727681912*^9, 3.4723150118481655`*^9, {3.4723154920366306`*^9, 
    3.472315496835905*^9}}],
 ">0 angenommen werden, da H(e,T)= max(e,0). Dann gilt:"
}], "Text",
 CellChangeTimes->{{3.472303393378627*^9, 3.4723034308737717`*^9}, {
   3.472303520482897*^9, 3.4723035367218256`*^9}, {3.4723063348188677`*^9, 
   3.4723063393791285`*^9}, {3.472314735211343*^9, 3.472314798506963*^9}, {
   3.472314862659632*^9, 3.4723148631226587`*^9}, {3.4723155761964445`*^9, 
   3.472315587419086*^9}, {3.4723156230031214`*^9, 3.472315648211563*^9}, 
   3.4723970944625616`*^9}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"oq3", "=", 
  RowBox[{"Simplify", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"A", "[", 
      RowBox[{
       RowBox[{
        SuperscriptBox["V", 
         TagBox[
          RowBox[{"(", 
           RowBox[{"0", ",", "2", ",", "0"}], ")"}],
          Derivative],
         MultilineFunction->None], "[", 
        RowBox[{"S", ",", "P", ",", "t"}], "]"}], ",", 
       RowBox[{"2", 
        RowBox[{
         SuperscriptBox["V", 
          TagBox[
           RowBox[{"(", 
            RowBox[{"1", ",", "1", ",", "0"}], ")"}],
           Derivative],
          MultilineFunction->None], "[", 
         RowBox[{"S", ",", "P", ",", "t"}], "]"}]}], ",", 
       RowBox[{"-", "M"}], ",", "M"}], "]"}], "/.", 
     RowBox[{"V", "\[Rule]", "Vr"}]}], "/.", 
    RowBox[{"P", "\[Rule]", 
     RowBox[{"e", "*", "S"}]}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.4723893748036966`*^9, 3.4723893875737143`*^9}, {
   3.4723894890838566`*^9, 3.47238949176386*^9}, {3.472390084308504*^9, 
   3.4723900849885054`*^9}, {3.4723901947186584`*^9, 
   3.4723902031586704`*^9}, {3.4723904167489696`*^9, 
   3.4723904210189753`*^9}, {3.4723951572383385`*^9, 3.472395158673541*^9}, {
   3.472395195552006*^9, 3.47239519814161*^9}, {3.4723952313384686`*^9, 
   3.472395232960871*^9}, 3.472396138632862*^9, 3.4723970944625616`*^9}],

Cell[BoxData[
 RowBox[{"\[Piecewise]", GridBox[{
    {"M", 
     RowBox[{
      RowBox[{"Abs", "[", 
       RowBox[{"e", "+", "M"}], "]"}], "<", 
      RowBox[{"Abs", "[", 
       RowBox[{"e", "-", "M"}], "]"}]}]},
    {
     RowBox[{"-", "M"}], 
     TagBox["True",
      "PiecewiseDefault",
      AutoDelete->False,
      DeletionWarning->True]}
   },
   GridBoxAlignment->{
    "Columns" -> {{Left}}, "ColumnsIndexed" -> {}, "Rows" -> {{Baseline}}, 
     "RowsIndexed" -> {}},
   GridBoxItemSize->{
    "Columns" -> {{Automatic}}, "ColumnsIndexed" -> {}, "Rows" -> {{1.}}, 
     "RowsIndexed" -> {}},
   GridBoxSpacings->{"Columns" -> {
       Offset[0.27999999999999997`], {
        Offset[0.84]}, 
       Offset[0.27999999999999997`]}, "ColumnsIndexed" -> {}, "Rows" -> {
       Offset[0.2], {
        Offset[0.4]}, 
       Offset[0.2]}, "RowsIndexed" -> {}}]}]], "Output",
 GeneratedCell->False,
 CellAutoOverwrite->False,
 CellChangeTimes->{{3.47238937039369*^9, 3.4723893881637154`*^9}, 
   3.472389492163861*^9, 3.4723900865585074`*^9, {3.4723901951586595`*^9, 
   3.4723902039086714`*^9}, {3.47239041702897*^9, 3.472390421168976*^9}, {
   3.4723951551323347`*^9, 3.472395162339547*^9}, 3.4723951988124113`*^9, 
   3.472395233506872*^9, 3.4723956173455467`*^9, {3.4723961395532637`*^9, 
   3.4723961593184986`*^9}, 3.4723970944625616`*^9}]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"oq3", "'"}], "=", 
   RowBox[{"\[Piecewise]", GridBox[{
      {"1", 
       RowBox[{"e", "<", "0"}]},
      {
       RowBox[{"-", "1"}], 
       TagBox["True",
        "PiecewiseDefault",
        AutoDelete->False,
        DeletionWarning->True]}
     },
     GridBoxAlignment->{
      "Columns" -> {{Left}}, "ColumnsIndexed" -> {}, "Rows" -> {{Baseline}}, 
       "RowsIndexed" -> {}},
     GridBoxItemSize->{
      "Columns" -> {{Automatic}}, "ColumnsIndexed" -> {}, "Rows" -> {{1.}}, 
       "RowsIndexed" -> {}},
     GridBoxSpacings->{"Columns" -> {
         Offset[0.27999999999999997`], {
          Offset[0.84]}, 
         Offset[0.27999999999999997`]}, "ColumnsIndexed" -> {}, "Rows" -> {
         Offset[0.2], {
          Offset[0.4]}, 
         Offset[0.2]}, "RowsIndexed" -> {}}]}]}], ";"}]], "Input",
 CellChangeTimes->{{3.4723156563130264`*^9, 3.472315697716395*^9}, 
   3.4723868990744915`*^9, {3.4723961423924685`*^9, 3.4723961486324797`*^9}, 
   3.4723970944625616`*^9}],

Cell[BoxData["\[IndentingNewLine]"], "Input",
 CellChangeTimes->{3.472315751500471*^9, 3.4723970944625616`*^9}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Gewinn durch nicht optimales Verhalten des Optionshalters", \
"Subsubtitle",
 CellChangeTimes->{{3.472306347186575*^9, 3.4723063618504133`*^9}, {
   3.472308494531396*^9, 3.4723085235470552`*^9}, {3.4723091613075333`*^9, 
   3.472309170395053*^9}, {3.472309674754901*^9, 3.4723096771230364`*^9}, {
   3.4723097519313154`*^9, 3.4723097590187206`*^9}, {3.4723157170435*^9, 
   3.4723157355705595`*^9}, 3.4723970944625616`*^9}],

Cell["\<\
Hedged man nach der optimalen Formel, so wird pro Zeiteinheit folgender \
deterministische Gewinn erzielt, wobei oq die optimale und q die tats\
\[ADoubleDot]chliche Strategie darstellt. Er errechnet sich aus der differenz \
der discontierten hedging portfolio (mit tats\[ADoubleDot]chlichem q) und dem \
discontierten options preis (der sich nach Ito auch mit dem \
tats\[ADoubleDot]chlichen q bewegt. Da bleiben aber nur dt-Terme \
\[UDoubleDot]brig. Setzt man hier jetzt ein, dass der Optionspreis einer \
Gleichung gen\[UDoubleDot]gt, die den optimalen q (oq) enth\[ADoubleDot]lt \
ergibt sich:\
\>", "Text",
 CellChangeTimes->{{3.472303393378627*^9, 3.4723034308737717`*^9}, {
   3.472303520482897*^9, 3.4723035367218256`*^9}, {3.4723063348188677`*^9, 
   3.4723063393791285`*^9}, {3.472314735211343*^9, 3.472314798506963*^9}, {
   3.472314862659632*^9, 3.4723148631226587`*^9}, {3.4723157390757604`*^9, 
   3.4723157625951056`*^9}, {3.4723959453485227`*^9, 3.4723960949683857`*^9}, 
   3.4723970944625616`*^9}],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Simplify", "[", 
  RowBox[{
   RowBox[{
    RowBox[{"(", 
     RowBox[{"dDV", "/.", 
      RowBox[{"q", "\[Rule]", "oq"}]}], ")"}], "-", "dDV"}], "/.", 
   RowBox[{"dW", "\[Rule]", "0"}]}], "]"}]], "Input",
 CellChangeTimes->{{3.472314563988549*^9, 3.472314630804371*^9}, {
   3.4723146854284954`*^9, 3.4723146875726175`*^9}, {3.4723157654122667`*^9, 
   3.4723157754278393`*^9}, {3.4723958491463537`*^9, 3.472395933698502*^9}, 
   3.4723970944625616`*^9}],

Cell[BoxData[
 RowBox[{
  FractionBox["1", "2"], " ", "dt", " ", 
  RowBox[{"(", 
   RowBox[{"oq", "-", "q"}], ")"}], " ", 
  SuperscriptBox["s", "2"], " ", 
  SuperscriptBox["S", "2"], " ", 
  RowBox[{"(", 
   RowBox[{
    RowBox[{
     RowBox[{"(", 
      RowBox[{"oq", "+", "q"}], ")"}], " ", 
     RowBox[{
      SuperscriptBox["V", 
       TagBox[
        RowBox[{"(", 
         RowBox[{"0", ",", "2", ",", "0"}], ")"}],
        Derivative],
       MultilineFunction->None], "[", 
      RowBox[{"S", ",", "P", ",", "t"}], "]"}]}], "+", 
    RowBox[{"2", " ", 
     RowBox[{
      SuperscriptBox["V", 
       TagBox[
        RowBox[{"(", 
         RowBox[{"1", ",", "1", ",", "0"}], ")"}],
        Derivative],
       MultilineFunction->None], "[", 
      RowBox[{"S", ",", "P", ",", "t"}], "]"}]}]}], ")"}]}]], "Output",
 GeneratedCell->False,
 CellAutoOverwrite->False,
 CellChangeTimes->{{3.472395870970792*^9, 3.4723959342601027`*^9}, 
   3.4723970944625616`*^9}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Boundary conditions", "Subsubtitle",
 CellChangeTimes->{{3.472306347186575*^9, 3.4723063618504133`*^9}, {
   3.472308494531396*^9, 3.4723085235470552`*^9}, {3.4723091613075333`*^9, 
   3.472309170395053*^9}, {3.472309674754901*^9, 3.4723096771230364`*^9}, {
   3.4723097519313154`*^9, 3.4723097590187206`*^9}, {3.4723157170435*^9, 
   3.4723157355705595`*^9}, 3.4723970944625616`*^9, {3.472404924521799*^9, 
   3.4724049270334034`*^9}}],

Cell["\<\
F\[UDoubleDot]r ausschlie\[SZ]lich Long-Positionen mit Anfangskapital M und \
Payoff max(P(t),0)\
\>", "Subsubtitle",
 CellChangeTimes->{{3.472306347186575*^9, 3.4723063618504133`*^9}, {
   3.472308494531396*^9, 3.4723085235470552`*^9}, {3.4723091613075333`*^9, 
   3.472309170395053*^9}, {3.472309674754901*^9, 3.4723096771230364`*^9}, {
   3.4723097519313154`*^9, 3.4723097590187206`*^9}, {3.4723913766744*^9, 
   3.472391408874445*^9}, 3.4723970944625616`*^9}],

Cell[TextData[{
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{"v", "(", 
     RowBox[{"S", ",", "P", ",", "T"}], ")"}], "=", 
    SuperscriptBox["P", "+"]}], TraditionalForm]]],
 "\n",
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{"v", "(", 
     RowBox[{"0", ",", "P", ",", "t"}], ")"}], "=", 
    SuperscriptBox["P", "+"]}], TraditionalForm]]],
 "\n",
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{"v", "(", 
     RowBox[{"S", ",", 
      RowBox[{"-", "M"}], ",", "t"}], ")"}], "=", "0"}], TraditionalForm]]],
 "\n",
 Cell[BoxData[
  FormBox[
   UnderscriptBox["lim", 
    RowBox[{"P", "\[Rule]", "\[Infinity]"}]], TraditionalForm]]],
 " v(S,P,t)/P=1\n",
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{"v", " ", 
     RowBox[{"(", 
      RowBox[{
       RowBox[{"S", ">", "P"}], ",", " ", "P", ",", " ", "t"}], ")"}]}], " ", 
    "=", " ", 
    SuperscriptBox["P", "+"]}], TraditionalForm]]]
}], "Text",
 CellChangeTimes->{{3.4724049469390383`*^9, 3.4724049625546656`*^9}, {
  3.4724050524264235`*^9, 3.472405070483257*^9}, {3.4724052086994996`*^9, 
  3.4724052473875675`*^9}, {3.472405285046034*^9, 3.4724054240422783`*^9}, {
  3.4724057552474594`*^9, 3.472405819956373*^9}, {3.472482464453651*^9, 
  3.472482513273443*^9}, {3.4724828551289964`*^9, 3.4724828636724854`*^9}, {
  3.4724832746459913`*^9, 3.472483281389377*^9}, {3.4724875374088078`*^9, 
  3.47248753779383*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["F\[UDoubleDot]r -1<= q <= 1", "Subsubtitle",
 CellChangeTimes->{{3.472306347186575*^9, 3.4723063618504133`*^9}, {
   3.472308494531396*^9, 3.4723085235470552`*^9}, {3.4723091613075333`*^9, 
   3.472309170395053*^9}, {3.472309674754901*^9, 3.4723096771230364`*^9}, {
   3.4723097519313154`*^9, 3.4723097590187206`*^9}, {3.4723149792272997`*^9, 
   3.4723150000344896`*^9}, {3.472387672899251*^9, 3.472387673414052*^9}, 
   3.4723970944625616`*^9}],

Cell[TextData[{
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{"v", "(", 
     RowBox[{"S", ",", "P", ",", "T"}], ")"}], "=", 
    SuperscriptBox["P", "+"]}], TraditionalForm]]],
 "\n",
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{"v", "(", 
     RowBox[{"0", ",", "P", ",", "t"}], ")"}], "=", 
    SuperscriptBox["P", "+"]}], TraditionalForm]]],
 "\nv(S,-\[Infinity],t)=0\n",
 Cell[BoxData[
  FormBox[
   UnderscriptBox["lim", 
    RowBox[{"P", "\[Rule]", "\[Infinity]"}]], TraditionalForm]]],
 " v(S,P,t)/P=1\n",
 Cell[BoxData[
  FormBox[
   RowBox[{
    RowBox[{"v", " ", 
     RowBox[{"(", 
      RowBox[{"\[Infinity]", ",", " ", "P", ",", " ", "t"}], ")"}]}], " ", 
    "=", " ", 
    SuperscriptBox["P", "+"]}], TraditionalForm]],
  FormatType->"TraditionalForm"]
}], "Text",
 CellChangeTimes->{
  3.4724831715990973`*^9, {3.4724832763580894`*^9, 3.472483302752599*^9}}],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.4724049363154197`*^9, 3.4724049374230213`*^9}, {
  3.4724831664798045`*^9, 3.4724831682449055`*^9}}]
}, Open  ]]
}, Open  ]]
},
WindowSize->{1069, 1182},
WindowMargins->{{Automatic, -941}, {Automatic, 0}},
CellContext->Notebook,
FrontEndVersion->"7.0 for Microsoft Windows (64-bit) (November 10, 2008)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[545, 20, 120, 2, 31, "Input"],
Cell[668, 24, 70, 2, 31, "Input"],
Cell[741, 28, 2977, 75, 112, "Input"],
Cell[CellGroupData[{
Cell[3743, 107, 9732, 257, 392, "Input"],
Cell[13478, 366, 2540, 73, 85, "Output"],
Cell[16021, 441, 6181, 200, 192, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[22239, 646, 135, 2, 31, "Input"],
Cell[22377, 650, 4876, 139, 191, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[27290, 794, 161, 3, 31, "Input"],
Cell[27454, 799, 9456, 288, 234, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[36947, 1092, 151, 2, 83, "Title"],
Cell[CellGroupData[{
Cell[37123, 1098, 2179, 50, 33, "Input"],
Cell[39305, 1150, 2892, 85, 85, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[42234, 1240, 1239, 33, 33, "Input"],
Cell[43476, 1275, 457, 11, 33, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[43970, 1291, 805, 23, 31, "Input"],
Cell[44778, 1316, 190, 3, 30, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[45005, 1324, 361, 10, 31, "Input"],
Cell[45369, 1336, 1053, 38, 47, "Output"]
}, Open  ]],
Cell[46437, 1377, 589, 9, 52, "Input"],
Cell[CellGroupData[{
Cell[47051, 1390, 101, 1, 36, "Subsection"],
Cell[47155, 1393, 1274, 35, 52, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[48466, 1433, 473, 8, 28, "Subsubtitle"],
Cell[48942, 1443, 694, 10, 29, "Text"],
Cell[CellGroupData[{
Cell[49661, 1457, 1178, 30, 47, "Input"],
Cell[50842, 1489, 2597, 72, 59, "Output"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[53488, 1567, 665, 10, 28, "Subsubtitle"],
Cell[54156, 1579, 749, 10, 29, "Text"],
Cell[CellGroupData[{
Cell[54930, 1593, 1312, 33, 33, "Input"],
Cell[56245, 1628, 2755, 78, 59, "Output"],
Cell[59003, 1708, 2923, 84, 69, "Output"],
Cell[61929, 1794, 2745, 78, 69, "Output"],
Cell[64677, 1874, 2721, 78, 69, "Output"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[67447, 1958, 452, 6, 28, "Subsubtitle"],
Cell[CellGroupData[{
Cell[67924, 1968, 428, 11, 31, "Input"],
Cell[68355, 1981, 144, 3, 30, "Output"]
}, Open  ]],
Cell[CellGroupData[{
Cell[68536, 1989, 810, 20, 31, "Input"],
Cell[69349, 2011, 710, 20, 30, "Output"]
}, Open  ]],
Cell[70074, 2034, 967, 22, 29, "Text"],
Cell[CellGroupData[{
Cell[71066, 2060, 1333, 34, 33, "Input"],
Cell[72402, 2096, 1348, 35, 42, "Output"]
}, Open  ]],
Cell[73765, 2134, 1034, 29, 42, "Input"],
Cell[74802, 2165, 111, 1, 52, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[74950, 2171, 430, 6, 28, "Subsubtitle"],
Cell[75383, 2179, 1026, 16, 65, "Text"],
Cell[CellGroupData[{
Cell[76434, 2199, 480, 11, 31, "Input"],
Cell[76917, 2212, 971, 32, 47, "Output"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[77937, 2250, 442, 6, 28, "Subsubtitle"],
Cell[78382, 2258, 473, 8, 28, "Subsubtitle"],
Cell[78858, 2268, 1393, 43, 92, "Text"]
}, Open  ]],
Cell[CellGroupData[{
Cell[80288, 2316, 452, 6, 28, "Subsubtitle"],
Cell[80743, 2324, 884, 31, 95, "Text"],
Cell[81630, 2357, 149, 2, 31, "Input"]
}, Open  ]]
}, Open  ]]
}
]
*)

(* End of internal cache information *)
